<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GRAVES-LAW | UNIVERSAL</title>
    <style>
        :root {
            --primary: #00ffcc;       /* Native 166 (Cyan) */
            --artifact: #ff3333;      /* Artifact 137 (Red) */
            --bg: #050505;
            --panel: #0a0f0d;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg);
            color: var(--primary);
            font-family: 'Courier New', monospace;
            margin: 0;
            height: 100dvh; /* Dynamic height for mobile browsers */
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- HEADER --- */
        header {
            height: 60px;
            background: #080808;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            flex-shrink: 0;
            z-index: 10;
        }

        .brand { font-weight: bold; font-size: 1em; letter-spacing: 1px; color: #fff; }
        
        .status-badge {
            font-size: 0.7em;
            padding: 4px 8px;
            border: 1px solid var(--artifact);
            color: var(--artifact);
            box-shadow: 0 0 10px rgba(255, 51, 51, 0.2);
            transition: all 0.5s;
            white-space: nowrap;
        }

        /* --- MAIN LAYOUT CONTAINER --- */
        #container {
            display: flex;
            flex-direction: column; /* Mobile: Stack Vertically */
            flex-grow: 1;
            overflow: hidden;
            position: relative;
        }

        /* --- VIEWPORT (CANVAS) --- */
        #viewport {
            position: relative;
            flex-grow: 1; /* Takes available space */
            background: radial-gradient(circle at center, #150505 0%, #000 100%);
            transition: background 2s;
            overflow: hidden;
            min-height: 40%; /* Ensure canvas is visible on mobile */
        }

        canvas { width: 100%; height: 100%; display: block; }

        /* Overlay Data */
        .overlay {
            position: absolute;
            top: 10px; left: 10px;
            pointer-events: none;
            background: rgba(0,0,0,0.5);
            padding: 5px;
            border-radius: 4px;
        }
        .overlay-row { font-size: 0.75em; color: #888; margin-bottom: 2px; }
        .overlay-val { color: var(--artifact); font-weight: bold; margin-left: 5px; }

        /* --- SIDEBAR / CONTROLS --- */
        #controls {
            background: var(--panel);
            border-top: 1px solid #333;
            display: flex;
            flex-direction: column;
            padding: 15px;
            gap: 15px;
            overflow-y: auto; /* Allow scrolling if controls get tall */
            flex-shrink: 0;
            max-height: 50%; /* Don't let controls eat the whole screen on mobile */
        }

        /* The Truth Block */
        .truth-panel {
            font-size: 0.75em;
            line-height: 1.4;
            color: #ccc;
            border: 1px solid #333;
            padding: 10px;
            background: rgba(255,255,255,0.02);
            display: none; /* Hide on small mobile by default to save space */
        }

        /* Industry Buttons (Horizontal scroll on mobile) */
        .industry-scroll {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        .industry-btn {
            background: #111;
            border: 1px solid #333;
            color: #777;
            padding: 10px;
            font-family: inherit;
            font-size: 0.75em;
            white-space: nowrap;
            cursor: pointer;
        }
        .industry-btn.active {
            border-color: var(--artifact);
            color: var(--artifact);
            background: rgba(255, 51, 51, 0.1);
        }

        /* Main Button */
        #main-btn {
            padding: 15px;
            background: transparent;
            border: 2px solid var(--artifact);
            color: var(--artifact);
            font-size: 1em;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        /* Data Deck (Hidden on very small mobile, shown on desktop) */
        #data-deck {
            display: none; 
        }

        /* --- DESKTOP BREAKPOINT (>900px) --- */
        @media (min-width: 900px) {
            #container {
                flex-direction: row; /* Side by side */
            }

            /* Sidebar becomes Left Column */
            #controls {
                width: 360px;
                height: 100%;
                border-top: none;
                border-right: 1px solid #333;
                order: 1; /* Left */
            }

            /* Viewport becomes Right Column */
            #viewport {
                order: 2; /* Right */
                display: flex;
                flex-direction: column;
            }
            
            #canvas-wrapper { flex-grow: 1; position: relative; }
            canvas { position: absolute; top:0; left:0; }

            /* Show Truth Panel & Data Deck on Desktop */
            .truth-panel { display: block; margin-bottom: auto; }
            #data-deck {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                padding: 15px;
                gap: 10px;
                background: #080808;
                border-top: 1px solid #333;
                height: 100px;
            }
            
            .industry-scroll {
                flex-direction: column;
                overflow-x: visible;
            }
            .industry-btn { width: 100%; text-align: left; }
        }

        /* Metric Styles (Desktop only) */
        .metric { border-left: 2px solid #333; padding-left: 10px; }
        .metric-label { font-size: 0.6em; color: #555; display: block; margin-bottom: 5px; }
        .metric-val { font-size: 1.2em; font-weight: bold; color: var(--artifact); }

        /* --- NATIVE MODE STYLES --- */
        body.mode-native .status-badge { border-color: var(--primary); color: var(--primary); box-shadow: 0 0 15px var(--primary); }
        body.mode-native #main-btn { border-color: var(--primary); color: #000; background: var(--primary); box-shadow: 0 0 30px var(--primary); }
        body.mode-native .overlay-val, body.mode-native .metric-val { color: var(--primary); }
        body.mode-native #viewport { background: radial-gradient(circle at center, #001a15 0%, #000 100%); }

    </style>
</head>
<body>

<header>
    <div class="brand">GRAVES-LAW</div>
    <div id="badge" class="status-badge">PHYSICS: ARTIFACT (137)</div>
</header>

<div id="container">
    
    <div id="controls">
        <div class="truth-panel">
            <strong>CORE PRINCIPLE</strong><br><br>
            Material is irrelevant. Geometry is everything.<br>
            Any alloy locked to φ-native symmetry collapses to <span style="color:#fff; background:rgba(0,255,204,0.1)">1/α = 166.083...</span>
        </div>

        <div style="font-size:0.7em; color:#666; margin-bottom:5px;">SELECT INDUSTRY (RESET)</div>
        <div class="industry-scroll">
            <button class="industry-btn active" onclick="setIndustry(this)">MACHINING</button>
            <button class="industry-btn" onclick="setIndustry(this)">AEROSPACE</button>
            <button class="industry-btn" onclick="setIndustry(this)">MEDICAL</button>
            <button class="industry-btn" onclick="setIndustry(this)">ENERGY</button>
        </div>

        <button id="main-btn" onclick="initiateSequence()">INITIATE SEQUENCE</button>
    </div>

    <div id="viewport">
        <div id="canvas-wrapper" style="width:100%; height:100%; position:relative;">
            <canvas id="sim-canvas"></canvas>
            
            <div class="overlay">
                <div class="overlay-row">STATE: <span id="ov-state" class="overlay-val">NOISY</span></div>
                <div class="overlay-row">SLACK: <span id="ov-slack" class="overlay-val">12.5nm</span></div>
            </div>
        </div>

        <div id="data-deck">
            <div class="metric">
                <span class="metric-label">FINE STRUCTURE</span>
                <div id="val-alpha" class="metric-val">137.036</div>
            </div>
            <div class="metric">
                <span class="metric-label">CONVERGENCE</span>
                <div id="val-conv" class="metric-val">0.0%</div>
            </div>
            <div class="metric">
                <span class="metric-label">ENTROPY</span>
                <div id="val-entropy" class="metric-val">HIGH</div>
            </div>
            <div class="metric">
                <span class="metric-label">STATUS</span>
                <div id="val-status" class="metric-val">VIBRATING</div>
            </div>
        </div>
    </div>

</div>

<script>
    const canvas = document.getElementById('sim-canvas');
    const ctx = canvas.getContext('2d');
    
    // UI Refs
    const ui = {
        body: document.body,
        badge: document.getElementById('badge'),
        btn: document.getElementById('main-btn'),
        ovState: document.getElementById('ov-state'),
        ovSlack: document.getElementById('ov-slack'),
        // Desktop Metrics
        valAlpha: document.getElementById('val-alpha'),
        valConv: document.getElementById('val-conv'),
        valEntropy: document.getElementById('val-entropy'),
        valStatus: document.getElementById('val-status')
    };

    let w, h;
    let state = 'ARTIFACT'; 
    let progress = 0;
    let time = 0;

    // Robust Resizing
    function resize() {
        const parent = canvas.parentElement;
        w = canvas.width = parent.clientWidth;
        h = canvas.height = parent.clientHeight;
    }
    window.addEventListener('resize', resize);
    // Call resize frequently during load to catch layout settling
    setInterval(resize, 500);
    resize();

    // Logic
    function setIndustry(el) {
        document.querySelectorAll('.industry-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        
        // Reset
        state = 'ARTIFACT';
        progress = 0;
        ui.body.classList.remove('mode-native');
        ui.btn.innerText = "INITIATE SEQUENCE";
        ui.btn.disabled = false;
        ui.badge.innerText = "PHYSICS: ARTIFACT (137)";
        
        // Reset Metrics
        ui.ovState.innerText = "NOISY";
        ui.ovSlack.innerText = "12.5nm";
        if(ui.valAlpha) {
            ui.valAlpha.innerText = "137.036";
            ui.valConv.innerText = "0.0%";
            ui.valEntropy.innerText = "HIGH";
            ui.valStatus.innerText = "VIBRATING";
        }
    }

    function initiateSequence() {
        if (state !== 'ARTIFACT') return;
        state = 'RUNNING';
        ui.btn.innerText = "ALIGNING...";
        ui.btn.disabled = true;
    }

    function loop() {
        // Clear
        ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
        ctx.fillRect(0, 0, w, h);

        const cx = w/2;
        const cy = h/2;
        const rMax = Math.min(w,h) * 0.35;

        // Progress Logic
        if (state === 'RUNNING') {
            progress += 0.008;
            updateMetrics(progress);
            if (progress >= 1) {
                progress = 1;
                state = 'LOCKED';
                finalize();
            }
        }

        let chaos = (state === 'ARTIFACT') ? 1 : (1 - progress);
        let hue = 170 * (1 - chaos); // 0(Red) -> 170(Cyan)

        ctx.strokeStyle = `hsl(${hue}, 100%, 50%)`;
        ctx.lineWidth = 1 + (3 * chaos);

        // Draw Lattice
        ctx.beginPath();
        for(let i=0; i<=360; i++) {
            let rad = i * Math.PI / 180;
            let noise = (Math.random()-0.5) * 50 * chaos;
            
            // Graves Function
            let tVar = (state === 'LOCKED') ? (Date.now()/1000) : (time*0.1);
            let geom = 30 * Math.cos(rad*5 + tVar);
            
            let r = rMax + noise + (geom * (1-chaos));
            let x = cx + r * Math.cos(rad);
            let y = cy + r * Math.sin(rad);
            
            i===0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
        }
        ctx.closePath();
        ctx.stroke();

        // Draw Core
        if (chaos < 0.8) {
            ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
            ctx.beginPath();
            let size = 4 + (chaos*20);
            ctx.arc(cx, cy, size, 0, Math.PI*2);
            ctx.fill();
            
            // Lock Lines
            if (state === 'LOCKED') {
                for(let k=0; k<5; k++){
                    let ang = (k*72 + Date.now()/20) * Math.PI/180;
                    ctx.beginPath();
                    ctx.strokeStyle = "rgba(0,255,204,0.3)";
                    ctx.moveTo(cx, cy);
                    ctx.lineTo(cx + Math.cos(ang)*rMax, cy + Math.sin(ang)*rMax);
                    ctx.stroke();
                }
            }
        }

        time++;
        requestAnimationFrame(loop);
    }

    function updateMetrics(p) {
        let alpha = 137.036 + (29.047 * p);
        if(ui.valAlpha) {
            ui.valAlpha.innerText = alpha.toFixed(3);
            ui.valConv.innerText = (p*100).toFixed(1) + "%";
            ui.valEntropy.innerText = p > 0.5 ? "DROPPING" : "HIGH";
            ui.valStatus.innerText = p > 0.8 ? "LOCKING" : "ALIGNING";
        }
    }

    function finalize() {
        ui.body.classList.add('mode-native');
        ui.btn.innerText = "ZERO-SLACK ACHIEVED";
        ui.badge.innerText = "PHYSICS: NATIVE (166)";
        ui.ovState.innerText = "PERFECT";
        ui.ovSlack.innerText = "0.00nm";
        
        if(ui.valAlpha) {
            ui.valAlpha.innerText = "166.083...";
            ui.valConv.innerText = "100.0%";
            ui.valEntropy.innerText = "ZERO";
            ui.valStatus.innerText = "LOCKED";
        }
    }

    loop();
</script>
</body>
</html>
