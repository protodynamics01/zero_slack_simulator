<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRAVES VALIDATION SUITE v40.0 | 40 SYSTEMS</title>
    <style>
        :root {
            --cyan: #00ffcc;
            --red: #ff3333;
            --gold: #ffaa00;
            --bg: #050505;
            --glass: rgba(10, 15, 20, 0.98);
            --border: 1px solid rgba(0, 255, 204, 0.2);
            --font-main: "Inter", system-ui, sans-serif;
            --font-mono: 'Courier New', monospace;
        }
        * { box-sizing: border-box; user-select: none; }
        body {
            margin: 0; background-color: var(--bg); color: #e0e0e0;
            font-family: var(--font-main); height: 100vh; overflow: hidden;
            display: grid; grid-template-rows: 40px 1fr 120px;
            background: radial-gradient(circle at center, #080808 0%, #000 100%);
        }
        header {
            background: rgba(0,0,0,0.9); border-bottom: var(--border);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; font-size: 0.75em; font-weight: 700; letter-spacing: 2px;
        }
        .clock-ref { font-family: var(--font-mono); font-size: 0.85em; color: #666; }
        .clock-live { color: var(--cyan); margin-left: 10px; }
        #workspace {
            display: grid; grid-template-columns: 300px 1fr 260px;
            height: 100%; overflow: hidden;
        }
        .panel {
            background: var(--glass); border-right: var(--border);
            padding: 12px; display: flex; flex-direction: column; gap: 6px;
            overflow-y: auto; max-height: 100%;
        }
        .panel-right { border-right: none; border-left: var(--border); }
        h2 { margin: 0 0 8px 0; font-size: 0.7em; color: #888; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #333; padding-bottom: 4px; }
        #industry-buttons { display: flex; gap: 3px; margin-bottom: 8px; }
        .industry-btn {
            flex: 1; padding: 6px 2px; background: rgba(0,0,0,0.6);
            border: 1px solid #333; color: #666; font-family: var(--font-mono);
            font-size: 0.6em; font-weight: 700; letter-spacing: 0.5px; cursor: pointer;
            transition: all 0.2s; text-transform: uppercase;
        }
        .industry-btn:hover { border-color: var(--cyan); color: #000; background: var(--cyan); }
        .industry-btn.active { background: var(--cyan); color: #000; border-color: var(--cyan); }
        .env-selector { display: flex; gap: 3px; margin-bottom: 8px; }
        .env-btn {
            flex: 1; padding: 5px 2px; background: rgba(0,0,0,0.6);
            border: 1px solid #333; color: #666; font-family: var(--font-mono);
            font-size: 0.55em; font-weight: 700; cursor: pointer; transition: all 0.2s;
        }
        .env-btn[data-env="ROOM"]:hover { border-color: var(--gold); color: #000; background: var(--gold); }
        .env-btn[data-env="ROOM"].active { background: var(--gold) !important; color: #000 !important; border-color: var(--gold) !important; }
        .env-btn[data-env="CRYO"]:hover { border-color: #7ec8ff; color: #000; background: #7ec8ff; }
        .env-btn[data-env="CRYO"].active { background: #7ec8ff !important; color: #000 !important; border-color: #7ec8ff !important; }
        #inv-list {
            height: 80px; min-height: 80px; max-height: 80px;
            overflow-y: auto; border: 1px solid #333; background: #000;
            font-family: var(--font-mono); font-size: 0.6em; flex-shrink: 0;
        }
        .inv-item {
            padding: 6px 8px; border-bottom: 1px solid #222; cursor: pointer; color: #666; transition: 0.2s;
            display: flex; justify-content: flex-start; align-items: center;
        }
        .inv-item:hover { background: rgba(0, 255, 204, 0.1); color: #fff; }
        .inv-item.active { background: var(--cyan); color: #000; font-weight: bold; }
        .inv-id { color: #444; margin-right: 12px; font-weight: bold; min-width: 30px; }
        .inv-item.active .inv-id { color: #000; }
        .inv-item.hidden { display: none; }
        .input-group { margin-bottom: 8px; }
        label { display: block; font-size: 0.65em; color: #666; margin-bottom: 2px; font-family: var(--font-mono); text-transform: uppercase; }
        input, textarea {
            width: 100%; background: #111; border: 1px solid #333; color: var(--cyan);
            padding: 6px; font-family: var(--font-mono); font-size: 0.8em; outline: none; resize: none;
        }
        #stage {
            position: relative; display: flex; flex-direction: column;
            padding: 12px; gap: 8px; background: radial-gradient(circle at center, #111 0%, #000 100%);
        }
        .graph-box {
            background: rgba(0,0,0,0.5); border: 1px solid #333;
            position: relative; padding: 8px; display: flex; flex-direction: column; overflow: hidden;
        }
        .graph-box.scanner { height: 100px; min-height: 100px; flex-shrink: 0; }
        .graph-box.lattice { flex: 1; min-height: 250px; }
        .graph-header { position: absolute; top: 6px; left: 8px; font-size: 0.6em; color: var(--cyan); font-weight: bold; z-index: 10;}
        .lock-indicator { position: absolute; top: 6px; right: 8px; font-size: 0.6em; color: #555; font-weight: bold; z-index: 10;}
        button {
            width: 100%; padding: 12px; background: rgba(0, 255, 204, 0.1);
            border: 1px solid var(--cyan); color: var(--cyan); font-family: var(--font-main);
            font-weight: 700; letter-spacing: 1px; cursor: pointer; transition: 0.2s;
            text-transform: uppercase; margin-top: 4px; font-size: 0.75em;
        }
        button:hover { background: var(--cyan); color: #000; }
        button:disabled { border-color: #333; color: #555; background: transparent; cursor: not-allowed; }
        #console {
            height: 100px; background: #000; border: 1px solid #333;
            font-family: var(--font-mono); font-size: 0.55em; color: #888;
            padding: 6px; overflow-y: auto; white-space: pre-wrap; line-height: 1.2; flex-shrink: 0;
        }
        .log-cyan { color: var(--cyan); }
        .log-red { color: var(--red); }
        .log-gold { color: var(--gold); }
        #scan-line {
            position: absolute; top: 0; left: 0; width: 2px; height: 100%; background: var(--cyan);
            box-shadow: 0 0 10px var(--cyan); opacity: 0; pointer-events: none; z-index: 5;
        }
        canvas { width: 100%; height: 100%; display: block; }
        .atom-label {
            position: absolute; color: #fff; font-size: 9px; font-family: var(--font-mono);
            pointer-events: none; text-shadow: 0 0 4px #000; font-weight: bold;
            opacity: 0; transition: opacity 0.5s; z-index: 5;
        }
        .atom-label.visible { opacity: 1; }
        #filter-count { font-family: var(--font-mono); font-size: 0.55em; color: #666; text-align: right; margin-bottom: 4px; }
        #patent-claim {
            flex: 1; min-height: 100px; background: #000; border: 1px solid #333;
            font-family: var(--font-mono); font-size: 0.5em; color: #aaa;
            padding: 6px; overflow-y: auto; white-space: pre-wrap; line-height: 1.3;
        }
        #comp-preview { height: 140px; border: 1px solid #333; background: #000; position: relative; }
        #comp-preview canvas { width: 100%; height: 100%; }
        .comp-label { position: absolute; top: 4px; left: 6px; font-size: 0.55em; color: var(--cyan); font-family: var(--font-mono); }
        #monitor-panel {
            display: flex; background: rgba(0,0,0,0.8); border-top: var(--border);
        }
        .monitor-box {
            flex: 1; position: relative; display: flex; flex-direction: column;
            padding: 8px; border-right: 1px solid rgba(255,255,255,0.1);
        }
        .monitor-box:last-child { border-right: none; }
        .monitor-header {
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.55em; font-weight: 700; letter-spacing: 0.5px; color: #666;
            margin-bottom: 4px; font-family: var(--font-mono);
        }
        .monitor-header span:last-child { color: var(--red); }
        .mini-canvas { flex: 1; width: 100%; }
        .small-box { flex: 0 0 80px; }
        .waam-box { background: #111; border: 1px solid #333; padding: 4px 6px; }
        .waam-label { font-size: 0.5em; color: #666; font-family: var(--font-mono); }
        .waam-value { font-size: 1em; color: var(--cyan); font-family: var(--font-mono); font-weight: bold; }
    </style>
</head>
<body>
<header>
    <div>GRAVES VALIDATION SUITE <span style="color:#666">// v40.0 | 40 SYSTEMS</span></div>
    <div id="industry-indicator" style="color:#666; font-size:0.85em; font-family:var(--font-mono);"></div>
    <div class="clock-ref">DEUTERIUM REF: <span class="clock-live" id="clock-display">327.384 MHz</span></div>
</header>
<div id="workspace">
    <div class="panel">
        <h2>1. Select System (40 Systems)</h2>
        <div id="industry-buttons">
            <button class="industry-btn active" data-filter="ALL">ALL</button>
            <button class="industry-btn" data-filter="AERO">AERO</button>
            <button class="industry-btn" data-filter="DEF">DEF</button>
            <button class="industry-btn" data-filter="MAT">MAT</button>
            <button class="industry-btn" data-filter="FUEL">FUEL</button>
        </div>
        <div class="env-selector">
            <button class="env-btn active" data-env="ROOM">ROOM</button>
            <button class="env-btn" data-env="CRYO">CRYO</button>
        </div>
        <div id="filter-count">Showing: 40 / 40</div>
        <div id="inv-list"></div>
        <button id="btn-action" disabled>SELECT A SYSTEM</button>
        <h2>2. Composition Specs</h2>
        <div class="input-group">
            <label>Primary Elements</label>
            <input type="text" id="comp-elements" readonly>
        </div>
        <div class="input-group">
            <label>Lattice Symmetry</label>
            <input type="text" id="lattice-type" readonly>
        </div>
        <div class="waam-box">
            <div class="waam-label">WAAM (Weighted Atomic Mass)</div>
            <div class="waam-value" id="waam-display">-- g/mol</div>
        </div>
        <h2>3. Full Patent Claim</h2>
        <div id="patent-claim">Select a system to view patent claim...</div>
    </div>
    <div id="stage">
        <div class="graph-box scanner">
            <div class="graph-header">HYPERFINE LOCK SCANNER (5.030° - 5.045°)</div>
            <div class="lock-indicator" id="lock-indicator">READY</div>
            <div id="scan-line"></div>
            <canvas id="scanCanvas"></canvas>
        </div>
        <div class="graph-box lattice" id="atom-container">
            <div class="graph-header">3D ATOMIC LATTICE (LIVE RENDER)</div>
            <canvas id="atomCanvas"></canvas>
        </div>
    </div>
    <div class="panel panel-right">
        <h2>4. Lock Results</h2>
        <div class="input-group">
            <label>Unique Lock Angle (°)</label>
            <input type="text" id="res-angle" readonly style="color:var(--gold); font-weight:bold;">
        </div>
        <div class="input-group">
            <label>Residual Slack</label>
            <input type="text" id="res-slack" readonly>
        </div>
        <h2>5. 2D Atomic Structure</h2>
        <div id="comp-preview">
            <div class="comp-label" id="lattice-label">ICOSAHEDRAL</div>
            <canvas id="compCanvas"></canvas>
        </div>
        <h2>6. Validation Log</h2>
        <div id="console"></div>
    </div>
</div>
<div id="monitor-panel">
    <div class="monitor-box small-box">
        <div class="monitor-header"><span>POTENTIAL (2D)</span></div>
        <canvas class="mini-canvas" id="potentialCanvas"></canvas>
    </div>
    <div class="monitor-box small-box">
        <div class="monitor-header"><span>PHASE SPACE</span></div>
        <canvas class="mini-canvas" id="phaseCanvas"></canvas>
    </div>
    <div class="monitor-box small-box">
        <div class="monitor-header"><span>VACUUM FLUX</span></div>
        <canvas class="mini-canvas" id="fluxCanvas"></canvas>
    </div>
    <div class="monitor-box small-box">
        <div class="monitor-header"><span>DEUTERIUM CLOCK</span></div>
        <canvas class="mini-canvas" id="clockCanvas"></canvas>
        <div style="display:flex; justify-content:space-between; font-size:0.5em; font-family:var(--font-mono); margin-top:2px;">
            <span id="clk-jit" style="color:#ff3333;">JIT:HIGH</span>
            <span id="clk-coh">COH:0.04</span>
        </div>
    </div>
    <div class="monitor-box" style="flex:2;">
        <div class="monitor-header"><span id="entropy-label">PHONON ENTROPY (137)</span><span id="entropy-stat">CRITICAL</span></div>
        <canvas class="mini-canvas" id="entropyCanvas"></canvas>
    </div>
    <div class="monitor-box" style="flex:2;">
        <div class="monitor-header"><span id="dephasing-label" style="color:var(--cyan);">THERMAL DEPHASING (166)</span><span id="dephasing-stat">SYNC LOST</span></div>
        <canvas class="mini-canvas" id="dephasingCanvas"></canvas>
    </div>
</div>
<script>
const ATOMIC_MASS={"H":1.008,"Li":6.94,"B":10.81,"C":12.01,"N":14.007,"O":15.999,"Mg":24.305,"Al":26.98,"Si":28.085,"S":32.06,"Ca":40.078,"Ti":47.867,"Cr":51.996,"Mn":54.938,"Fe":55.845,"Co":58.933,"Ni":58.693,"Cu":63.546,"Zn":65.38,"Ge":72.63,"Y":88.906,"Zr":91.224,"Nb":92.906,"Mo":95.95,"Rh":102.91,"Pd":106.42,"Ag":107.868,"La":138.91,"Gd":157.25,"Hf":178.49,"Ta":180.948,"W":183.84,"Re":186.207,"Os":190.23,"Ir":192.217,"Pt":195.084,"Au":196.967,"Pb":207.2,"U":238.029,"Th":232.04};
const ELEMENT_COLORS={"C":"#888888","Si":"#b0b0ff","Fe":"#ff8844","Al":"#aaaaff","Ti":"#ccccff","Ni":"#99ff99","Co":"#ff99dd","Cr":"#ffaa44","W":"#ffff66","Mo":"#cc99ff","Nb":"#88ddff","Cu":"#ff9955","Zr":"#aaffaa","Ag":"#dddddd","B":"#ffaacc","Re":"#ffcc88","Hf":"#99ccff","Ta":"#bb99ff","Au":"#ffd700","H":"#ffffff","O":"#ff4444","N":"#3333ff","Y":"#aaffcc","Gd":"#ffaaff","Ir":"#ffff99","Os":"#ccff99","Rh":"#ffccff","La":"#aaccff","Li":"#ff6666","Ge":"#88aaff","Pd":"#ccddff","Ca":"#ffccaa","S":"#ffff00","Mg":"#aaddaa"};
const DB={
// AERO (001-010): Aerospace Propulsion - 10 systems
"001":{name:"Icosahedral Ni Superalloy Turbine Blade",elements:["Ni","Co","Cr","Al","Ti","Mo","W","Nb"],lattice:"Icosahedral",type:"metal",industry:"AERO"},
"002":{name:"Decagonal Co Superalloy Turbine Disk",elements:["Co","Cr","Ni","W","Al","Ta"],lattice:"Decagonal",type:"metal",industry:"AERO"},
"003":{name:"Pentagonal Re-Free Single-Crystal Blade",elements:["Ni","Ta","W","Al","Cr","Co","Mo"],lattice:"Pentagonal",type:"metal",industry:"AERO"},
"004":{name:"Icosahedral Ti Aluminide Blade",elements:["Ti","Al","Cr","Nb"],lattice:"Icosahedral",type:"metal",industry:"AERO"},
"005":{name:"Decagonal SiC-SiC CMC",elements:["Si","C"],lattice:"Decagonal",type:"metal",industry:"AERO"},
"006":{name:"Pentagonal Thermal Barrier Coating",elements:["Zr","Y","Gd","O"],lattice:"Pentagonal",type:"metal",industry:"AERO"},
"007":{name:"Icosahedral Shape-Memory Actuator",elements:["Ni","Ti","Hf"],lattice:"Icosahedral",type:"metal",industry:"AERO"},
"008":{name:"Decagonal Ultra-High-Temp Nb Alloy",elements:["Nb","Si","Ti","Hf","Cr"],lattice:"Decagonal",type:"metal",industry:"AERO"},
"009":{name:"Pentagonal Abradable Turbine Seal",elements:["Al","Si","B","N"],lattice:"Pentagonal",type:"metal",industry:"AERO"},
"010":{name:"Icosahedral Inconel 718 Fastener",elements:["Ni","Cr","Fe","Nb","Mo","Ti","Al"],lattice:"Icosahedral",type:"metal",industry:"AERO"},
// DEF (011-015): Defense Armor & Protection - 5 systems
"011":{name:"Icosahedral B4C Ceramic Body Armor",elements:["B","C"],lattice:"Icosahedral",type:"metal",industry:"DEF"},
"012":{name:"Decagonal SiC Ballistic Plate",elements:["Si","C"],lattice:"Decagonal",type:"metal",industry:"DEF"},
"013":{name:"Pentagonal Fe-Si-B Radar Absorbing Coating",elements:["Fe","Si","B"],lattice:"Pentagonal",type:"metal",industry:"DEF"},
"014":{name:"Icosahedral Ti-Al-V Blast Shield",elements:["Ti","Al","V"],lattice:"Icosahedral",type:"metal",industry:"DEF"},
"015":{name:"Decagonal Al2O3-ZrO2 Vehicle Armor",elements:["Al","O","Zr"],lattice:"Decagonal",type:"metal",industry:"DEF"},
// MAT (016-020): Construction & Infrastructure Materials - 5 systems
"016":{name:"Pentagonal Ultra-High-Performance Concrete",elements:["Ca","Si","O","Al","Fe"],lattice:"Pentagonal",type:"metal",industry:"MAT"},
"017":{name:"Icosahedral High-Strength Steel Rebar",elements:["Fe","C","Mn","Si","Cr"],lattice:"Icosahedral",type:"metal",industry:"MAT"},
"018":{name:"Decagonal Corrosion-Resistant Al Alloy",elements:["Al","Mg","Si","Cu","Zn"],lattice:"Decagonal",type:"metal",industry:"MAT"},
"019":{name:"Pentagonal High-Strength Ti Fastener",elements:["Ti","Al","V"],lattice:"Pentagonal",type:"metal",industry:"MAT"},
"020":{name:"Icosahedral Fiber-Reinforced Polymer",elements:["C","H","O","N"],lattice:"Icosahedral",type:"metal",industry:"MAT"},
// FUEL (101-120): Hydrocarbon Perfection Catalysts - 20 systems
"101":{name:"GPC-1 Gasoline Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C8H18",industry:"FUEL"},
"102":{name:"DPC-1 Diesel Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C12H26",industry:"FUEL"},
"103":{name:"JPC-1 Jet-A Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C14H30",industry:"FUEL"},
"104":{name:"MPC-1 Methalox Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"CH4",industry:"FUEL"},
"105":{name:"RPC-1 RP-1 Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C12H24",industry:"FUEL"},
"106":{name:"LPC-1 LPG Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C4H10",industry:"FUEL"},
"107":{name:"HPC-1 Heavy Fuel Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C16H34",industry:"FUEL"},
"108":{name:"NGC-1 Natural Gas Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"CH4",industry:"FUEL"},
"109":{name:"EPC-1 Ethane Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C2H6",industry:"FUEL"},
"110":{name:"PPC-1 Propane Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C3H8",industry:"FUEL"},
"111":{name:"BuPC-1 Butane Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C4H10",industry:"FUEL"},
"112":{name:"PePC-1 Pentane Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C5H12",industry:"FUEL"},
"113":{name:"HxPC-1 Hexane Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C6H14",industry:"FUEL"},
"114":{name:"HpPC-1 Heptane Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C7H16",industry:"FUEL"},
"115":{name:"NPC-1 Nonane Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C9H20",industry:"FUEL"},
"116":{name:"DcPC-1 Decane Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C10H22",industry:"FUEL"},
"117":{name:"HyPC-1 Hydrogen Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"H2",industry:"FUEL"},
"118":{name:"APC-1 Ammonia Perfection Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"NH3",industry:"FUEL"},
"119":{name:"F1PC-1 F-1 Engine Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"C12H24",industry:"FUEL"},
"120":{name:"RSPC-1 RS-25 Engine Catalyst",elements:["Ir","Os","Rh","B"],lattice:"Icosahedral",type:"catalyst",molecular:"H2",industry:"FUEL"}
};
const FILTER_MAP={"ALL":"ALL","AERO":"AERO","DEF":"DEF","MAT":"MAT","FUEL":"FUEL"};
let currentRank=null,isScanning=false,isLocked=false,uniqueAngle=0,atoms=[],currentFilter="ALL",currentEnv="ROOM",time=0,waveS=[],waveG=[];
const invList=document.getElementById('inv-list'),scanCtx=document.getElementById('scanCanvas').getContext('2d'),atomCtx=document.getElementById('atomCanvas').getContext('2d'),compCtx=document.getElementById('compCanvas').getContext('2d'),consoleDiv=document.getElementById('console');
const potCtx=document.getElementById('potentialCanvas').getContext('2d'),phaseCtx=document.getElementById('phaseCanvas').getContext('2d'),fluxCtx=document.getElementById('fluxCanvas').getContext('2d'),clockCtx=document.getElementById('clockCanvas').getContext('2d'),entropyCtx=document.getElementById('entropyCanvas').getContext('2d'),dephasingCtx=document.getElementById('dephasingCanvas').getContext('2d');
const atomContainer=document.getElementById('atom-container');

function matchesFilter(id,f){if(f==="ALL")return true;const ind=DB[id]?.industry;if(f==="MAT")return ind==="MAT"||ind==="MATERIALS";if(f==="DEF")return ind==="DEF"||ind==="DEFENSE";if(f==="FUEL")return ind==="FUEL"||ind==="HYDRO";return ind===f;}
function applyFilter(f){currentFilter=f;document.querySelectorAll('.industry-btn').forEach(b=>b.classList.toggle('active',b.dataset.filter===f));let c=0;document.querySelectorAll('.inv-item').forEach(i=>{const m=matchesFilter(i.dataset.id,f);i.classList.toggle('hidden',!m);if(m)c++;});document.getElementById('filter-count').innerText=`Showing: ${c} / 40`;document.getElementById('industry-indicator').innerText=f==="ALL"?"":`FILTER: ${f}`;log(`FILTER: ${f} (${c})`,"cyan");}
function setButtonState(s){const b=document.getElementById('btn-action');const st={disabled:{d:true,t:"SELECT A SYSTEM",bc:"#333",c:"#555",bg:"transparent"},scan:{d:false,t:"▶ INITIATE TORSION SCAN",bc:"var(--cyan)",c:"var(--cyan)",bg:"rgba(0,255,204,0.1)",ck:runScan},scanning:{d:true,t:"⟳ SCANNING...",bc:"#ffaa00",c:"#ffaa00",bg:"rgba(255,170,0,0.1)"},fabricate:{d:false,t:"⬇ GENERATE FABRICATION",bc:"#ff3333",c:"#ff3333",bg:"rgba(255,51,51,0.1)",ck:generateFab},reset:{d:false,t:"↻ RESET",bc:"var(--gold)",c:"var(--gold)",bg:"rgba(255,170,0,0.1)",ck:resetSystem}};const x=st[s];b.disabled=x.d;b.innerText=x.t;b.style.borderColor=x.bc;b.style.color=x.c;b.style.background=x.bg;b.onclick=x.ck||null;}
function selectRank(id){if(isScanning)return;currentRank=id;const d=DB[id];document.querySelectorAll('.inv-item').forEach(i=>i.classList.remove('active'));document.querySelector(`.inv-item[data-id="${id}"]`).classList.add('active');document.getElementById('comp-elements').value=d.elements.join(' - ');document.getElementById('lattice-type').value=d.lattice;document.getElementById('res-angle').value="--";document.getElementById('res-slack').value="--";document.getElementById('lattice-label').innerText=d.lattice.toUpperCase();uniqueAngle=calculateLock(id,d);updateAtomTargets(d.lattice);drawCompChart(d);updatePatentClaim(id,d);isLocked=false;clearLabels();document.getElementById('lock-indicator').innerText="READY";document.getElementById('lock-indicator').style.color="#555";log(`SELECTED: ${d.name}`,"gold");log(`TARGET LOCK: ${uniqueAngle.toFixed(6)}°`,"gold");setButtonState("scan");}
function resetSystem(){document.getElementById('res-angle').value="--";document.getElementById('res-slack').value="--";document.getElementById('lock-indicator').innerText="READY";document.getElementById('lock-indicator').style.color="#555";isLocked=false;clearLabels();log("SYSTEM RESET.","cyan");setButtonState("scan");}
function calculateLock(id,d){const BASE=5.0372;let shift=0,avg=50;if(d.type==="catalyst"){const mw={"CH4":16,"C2H6":30,"C3H8":44,"C4H10":58,"C5H12":72,"C6H14":86,"C7H16":100,"C8H18":114,"C9H20":128,"C10H22":142,"C11H24":156,"C12H26":170,"C13H28":184,"C14H30":198,"C15H32":212,"C16H34":226,"C17H36":240,"C18H38":254,"C20H42":282,"C12H24":168,"H2":2,"CO":28,"NH3":17,"C2H6O":46,"CxHy":100};avg=mw[d.molecular]||100;shift=(100-avg)*0.00002;}else{let t=0,c=0;d.elements.forEach(el=>{if(ATOMIC_MASS[el]){t+=ATOMIC_MASS[el];c++;}});avg=c>0?t/c:50;shift=(avg-77.1)*0.00005;}if(d.lattice==="Pentagonal")shift+=0.0003;if(d.lattice==="Decagonal")shift-=0.0002;document.getElementById('waam-display').innerText="~"+avg.toFixed(2)+" g/mol";return BASE+shift;}
function updatePatentClaim(id,d){const a=uniqueAngle;const productDesc={
// AERO (001-010): Aerospace Propulsion
"001":"TURBINE BLADE\nHigh-temperature aerospace propulsion, 1850°C continuous",
"002":"TURBINE DISK\nRotating engine components for jet propulsion",
"003":"SINGLE-CRYSTAL BLADE\nRhenium-free turbine airfoils, cost reduction",
"004":"LIGHTWEIGHT BLADE\nTi aluminide weight-critical aerospace components",
"005":"CERAMIC MATRIX COMPOSITE\nUltra-high-temp SiC-SiC structural ceramics",
"006":"THERMAL BARRIER COATING\nHypersonic vehicle and turbine thermal protection",
"007":"SHAPE-MEMORY ACTUATOR\nMorphing structures, adaptive mechanisms",
"008":"REFRACTORY ALLOY\nExtreme environment Nb-Si structural materials",
"009":"ABRADABLE SEAL\nTurbine tip clearance control",
"010":"AEROSPACE FASTENER\nInconel 718 high-strength fasteners",
// DEF (011-015): Defense Armor & Protection
"011":"B4C CERAMIC ARMOR\nBoron carbide body armor, SAPI plates",
"012":"SiC BALLISTIC PLATE\nSilicon carbide vehicle/tank armor",
"013":"RADAR ABSORBING COATING\nFe-Si-B stealth coating for aircraft/ships",
"014":"BLAST SHIELD\nTi-Al-V IED/blast protection for MRAPs",
"015":"COMPOSITE VEHICLE ARMOR\nAl2O3-ZrO2 multi-hit capable armor",
// MAT (016-020): Construction & Infrastructure
"016":"ULTRA-HIGH-PERFORMANCE CONCRETE\nRapid-cure airstrip/bunker construction",
"017":"HIGH-STRENGTH REBAR\nBlast-resistant structure reinforcement",
"018":"CORROSION-RESISTANT ALUMINUM\nPrefab structures, expeditionary bridging",
"019":"HIGH-STRENGTH TI FASTENER\nStructural connections, corrosion-free",
"020":"FIBER-REINFORCED POLYMER\nLightweight panels, rapid construction",
// FUEL (101-120): Hydrocarbon Perfection Catalysts
"101":"GASOLINE CATALYST\nComplete combustion for 87-93 AKI fuels",
"102":"DIESEL CATALYST\nZero-emission diesel/biodiesel combustion",
"103":"JET FUEL CATALYST\nZero-contrail aviation propulsion",
"104":"METHALOX CATALYST\nMethane/LOX rocket propulsion (Raptor)",
"105":"RP-1 CATALYST\nKerosene rocket propulsion (Merlin/RD-180)",
"106":"LPG CATALYST\nPropane/butane complete combustion",
"107":"HEAVY FUEL CATALYST\nMarine bunker fuel zero-sulfur burn",
"108":"NATURAL GAS CATALYST\nPower generation zero methane slip",
"109":"ETHANE CATALYST\nEthane cracking optimization",
"110":"PROPANE CATALYST\nPropane zero-emission combustion",
"111":"BUTANE CATALYST\nButane complete combustion",
"112":"PENTANE CATALYST\nPentane isomer perfect combustion",
"113":"HEXANE CATALYST\nHexane solvent zero-VOC burn",
"114":"HEPTANE CATALYST\nReference fuel standard perfection",
"115":"NONANE CATALYST\nDiesel blend zero-particulate burn",
"116":"DECANE CATALYST\nJet fuel component optimization",
"117":"HYDROGEN CATALYST\nH2/O2 fuel cell and rocket optimization",
"118":"AMMONIA CATALYST\nNH3 fuel zero-NOx combustion",
"119":"F-1 ENGINE CATALYST\nSaturn-class rocket thrust optimization",
"120":"RS-25 ENGINE CATALYST\nSpace Shuttle main engine optimization"
};const desc=productDesc[id]||`${d.lattice.toUpperCase()} SYSTEM\n${d.name}`;let txt=`${desc}\n\n═══ LFGKC PATENT CLAIM ═══\nSystem ${id}: ${d.name}\n\nCLAIM 1: A ${d.lattice.toLowerCase()} quasicrystalline\ncomposition comprising:\n`;d.elements.forEach((el,i)=>{txt+=`  (${String.fromCharCode(97+i)}) ${el} [${(ATOMIC_MASS[el]||0).toFixed(2)} g/mol]\n`;});txt+=`\nCLAIM 2: The composition of Claim 1, wherein\nsaid elements are arranged in a ${d.lattice.toLowerCase()}\nlattice exhibiting:\n  • Lock Angle: ${a.toFixed(6)}°\n  • WAAM: ${document.getElementById('waam-display').innerText}\n  • Phason Strain: 0.000 (zero-slack)\n  • Vacuum Debt: ZERO\n\nCLAIM 3: The composition of Claim 2, wherein\nsaid lock angle is derived from:\n  θ = 5.0372° + Δ(WAAM)\n  where Δ = f(composition, lattice)\n\nCLAIM 4: Method for synthesizing the\ncomposition of Claims 1-3 via LFGKC.`;document.getElementById('patent-claim').innerText=txt;}
function drawCompChart(d){const c=compCtx,cv=c.canvas;const dpr=window.devicePixelRatio||1;const rect=cv.getBoundingClientRect();cv.width=rect.width*dpr;cv.height=rect.height*dpr;c.scale(dpr,dpr);const w=rect.width,h=rect.height,cx=w/2,cy=h/2,r=Math.min(w,h)/2.5;c.fillStyle='#000';c.fillRect(0,0,w,h);const n=d.elements.length,pos=[];d.elements.forEach((el,i)=>{const ang=(i/n)*Math.PI*2-Math.PI/2;const x=cx+Math.cos(ang)*r,y=cy+Math.sin(ang)*r;pos.push({x,y,el});});c.strokeStyle='rgba(0,255,204,0.3)';c.lineWidth=1;for(let i=0;i<pos.length;i++){for(let j=i+1;j<pos.length;j++){c.beginPath();c.moveTo(pos[i].x,pos[i].y);c.lineTo(pos[j].x,pos[j].y);c.stroke();}}pos.forEach(p=>{c.fillStyle=ELEMENT_COLORS[p.el]||"#888";c.beginPath();c.arc(p.x,p.y,14,0,Math.PI*2);c.fill();c.fillStyle="#000";c.font="bold 10px 'Courier New'";c.textAlign="center";c.textBaseline="middle";c.fillText(p.el,p.x,p.y);});}
function log(m,t=''){const d=document.createElement('div');d.innerHTML=`> ${m}`;if(t)d.className=`log-${t}`;consoleDiv.appendChild(d);consoleDiv.scrollTop=consoleDiv.scrollHeight;}
function runScan(){if(!currentRank)return;isScanning=true;let lockTriggered=false;setButtonState("scanning");document.getElementById('lock-indicator').innerText="SCANNING...";document.getElementById('lock-indicator').style.color="var(--cyan)";document.getElementById('scan-line').style.opacity=1;log("SCANNING...","cyan");const{w,h}=scaleCanvas(scanCtx);let x=0;scanCtx.fillStyle='#000';scanCtx.fillRect(0,0,w,h);drawGrid(scanCtx);const tm=setInterval(()=>{x+=3;document.getElementById('scan-line').style.left=x+"px";const ang=5.030+(x/w)*0.015;const dist=Math.abs(ang-uniqueAngle);const en=Math.min(1,Math.pow(dist*300,2));scanCtx.fillStyle=dist<0.0005?"#fff":"#ff3333";scanCtx.fillRect(x,en*(h*0.7)+(h*0.15),2,2);if(!lockTriggered&&dist<0.0005){lockTriggered=true;isLocked=true;const lockX=x;scanCtx.strokeStyle='#ffaa00';scanCtx.lineWidth=2;scanCtx.beginPath();scanCtx.moveTo(lockX,0);scanCtx.lineTo(lockX,h);scanCtx.stroke();scanCtx.fillStyle='#ffaa00';scanCtx.font='bold 12px monospace';scanCtx.textAlign='center';scanCtx.fillText('LOCK',lockX,15);scanCtx.fillText(uniqueAngle.toFixed(6)+'°',lockX,h-5);document.getElementById('lock-indicator').innerText="LOCKED";document.getElementById('lock-indicator').style.color="var(--gold)";document.getElementById('res-angle').value=uniqueAngle.toFixed(6)+"°";document.getElementById('res-slack').value="0.000 nm (PERFECT)";log(`LOCK ACQUIRED: ${uniqueAngle.toFixed(6)}°`,"gold");createLabels();}if(x>=w){clearInterval(tm);finishLock();}},8);}
function finishLock(){isScanning=false;isLocked=true;setButtonState("fabricate");document.getElementById('scan-line').style.opacity=0;document.getElementById('lock-indicator').innerText="LOCKED";document.getElementById('lock-indicator').style.color="var(--gold)";document.getElementById('res-angle').value=uniqueAngle.toFixed(6)+"°";document.getElementById('res-slack').value="0.000 nm (PERFECT)";log(`LOCK ACQUIRED: ${uniqueAngle.toFixed(6)}°`,"gold");createLabels();drawLockMarker();}
function drawLockMarker(){const rect=scanCtx.canvas.getBoundingClientRect();const w=rect.width,h=rect.height;const lockX=((uniqueAngle-5.030)/0.015)*w;scanCtx.strokeStyle='#00ffcc';scanCtx.lineWidth=2;scanCtx.beginPath();scanCtx.moveTo(lockX,0);scanCtx.lineTo(lockX,h);scanCtx.stroke();scanCtx.fillStyle='#00ffcc';scanCtx.font='bold 11px monospace';scanCtx.textAlign='center';scanCtx.fillText(uniqueAngle.toFixed(6)+'°',lockX,h-25);scanCtx.beginPath();scanCtx.arc(lockX,h*0.15,6,0,Math.PI*2);scanCtx.fill();}
function initAtoms(){atoms=[];for(let i=0;i<60;i++)atoms.push({x:(Math.random()-0.5)*400,y:(Math.random()-0.5)*400,z:(Math.random()-0.5)*400,tx:0,ty:0,tz:0});}
function updateAtomTargets(lat){const sc=160;let tg=[];if(lat==="Decagonal"){for(let k=0;k<5;k++)for(let j=0;j<10;j++)tg.push({x:Math.cos(j/10*Math.PI*2)*sc,y:(k-2)*50,z:Math.sin(j/10*Math.PI*2)*sc});}else if(lat==="Pentagonal"){for(let i=0;i<60;i++)tg.push({x:Math.cos(i*(Math.PI*2/5)+i*0.1)*(i/60)*sc*1.5,y:(i-30)*4,z:Math.sin(i*(Math.PI*2/5)+i*0.1)*(i/60)*sc*1.5});}else{const phi=1.618;[[0,1,phi],[0,-1,phi],[0,1,-phi],[0,-1,-phi],[1,phi,0],[-1,phi,0],[1,-phi,0],[-1,-phi,0],[phi,0,1],[-phi,0,1],[phi,0,-1],[-phi,0,-1]].forEach(p=>tg.push({x:p[0]*sc,y:p[1]*sc,z:p[2]*sc}));while(tg.length<60)tg.push({x:(Math.random()-0.5)*sc*1.5,y:(Math.random()-0.5)*sc*1.5,z:(Math.random()-0.5)*sc*1.5});}atoms.forEach((a,i)=>{const t=tg[i%tg.length];a.tx=t.x;a.ty=t.y;a.tz=t.z;});}
function drawLoop(){time+=0.02;drawMainView();drawMonitors();requestAnimationFrame(drawLoop);}
function drawMainView(){const{w,h}=scaleCanvas(atomCtx);const cx=w/2,cy=h/2-20;if(!currentRank)return;const rot=isLocked?time*0.2:time;const els=DB[currentRank].elements;const rl=atoms.map((a,i)=>{const n=isLocked?0:Math.sin(time+i)*60;let cx_=(isLocked?a.tx:a.x)+n,cy_=(isLocked?a.ty:a.y)+n,cz_=(isLocked?a.tz:a.z)+n;const x1=cx_*Math.cos(rot)-cz_*Math.sin(rot);const z1=cx_*Math.sin(rot)+cz_*Math.cos(rot);const y1=cy_*Math.cos(rot*0.5)-z1*Math.sin(rot*0.5);const z2=cy_*Math.sin(rot*0.5)+z1*Math.cos(rot*0.5);const sc=500/(500+z2+400);return{x:cx+x1*sc,y:cy+y1*sc,z:z2,s:sc,i};}).sort((a,b)=>b.z-a.z);atomCtx.strokeStyle=isLocked?"rgba(0,255,204,0.3)":"rgba(255,80,80,0.4)";atomCtx.beginPath();for(let i=0;i<rl.length;i++)for(let j=i+1;j<rl.length;j++)if(Math.hypot(rl[i].x-rl[j].x,rl[i].y-rl[j].y)<70*rl[i].s){atomCtx.moveTo(rl[i].x,rl[i].y);atomCtx.lineTo(rl[j].x,rl[j].y);}atomCtx.stroke();rl.forEach(p=>{atomCtx.fillStyle=isLocked?(ELEMENT_COLORS[els[p.i%els.length]]||"#0fc"):"#fff";atomCtx.beginPath();atomCtx.arc(p.x,p.y,(isLocked?4:3)*p.s,0,Math.PI*2);atomCtx.fill();if(isLocked){const lbl=document.getElementById(`lbl-${p.i}`);if(lbl){lbl.style.left=(p.x+8)+'px';lbl.style.top=(p.y-8)+'px';}}});}
const dpr=window.devicePixelRatio||1;
function scaleCanvas(ctx){const rect=ctx.canvas.getBoundingClientRect();ctx.canvas.width=rect.width*dpr;ctx.canvas.height=rect.height*dpr;ctx.scale(dpr,dpr);return{w:rect.width,h:rect.height};}
function drawMonitors(){const envCol=currentEnv==="CRYO"?"#4da6ff":"#ffaa00";const lockedCol='#00ffcc';const col=isLocked?lockedCol:envCol;
let{w,h}=scaleCanvas(potCtx);potCtx.strokeStyle=col;potCtx.lineWidth=2;potCtx.beginPath();for(let x=0;x<w;x++){let nx=(x-w/2)/(w/4);let y=isLocked?(nx*nx):(Math.pow(nx,4)-Math.pow(nx,2));potCtx.lineTo(x,h*0.8-(y*h*0.3));}potCtx.stroke();
({w,h}=scaleCanvas(phaseCtx));phaseCtx.strokeStyle=col;phaseCtx.lineWidth=1;phaseCtx.beginPath();phaseCtx.arc(w/2,h/2,Math.min(w,h)/3+(isLocked?0:(Math.random()-0.5)*(currentEnv==="CRYO"?3:10)),0,Math.PI*2);phaseCtx.stroke();
({w,h}=scaleCanvas(fluxCtx));fluxCtx.strokeStyle=col;fluxCtx.beginPath();if(isLocked){fluxCtx.lineWidth=1.5;for(let t=0;t<Math.PI*2;t+=0.1){let x=w/2+Math.min(w,h)/3*Math.sin(t*3+time*0.1),y=h/2+Math.min(w,h)/3*Math.sin(t*2);if(t===0)fluxCtx.moveTo(x,y);else fluxCtx.lineTo(x,y);}}else{fluxCtx.lineWidth=1;let fluxAmp=currentEnv==="CRYO"?0.3:0.6;for(let x=0;x<w;x+=4)fluxCtx.lineTo(x,h/2+(Math.random()-0.5)*h*fluxAmp);}fluxCtx.stroke();
({w,h}=scaleCanvas(clockCtx));let grd=clockCtx.createLinearGradient(0,0,w,0);if(isLocked){grd.addColorStop(0.4,"#004433");grd.addColorStop(0.5,"#00ffcc");grd.addColorStop(0.6,"#004433");}else if(currentEnv==="CRYO"){grd.addColorStop(0,"#1a4a6a");grd.addColorStop(0.5,"#4da6ff");grd.addColorStop(1,"#1a4a6a");}else{grd.addColorStop(0,"#664400");grd.addColorStop(0.5,"#ffaa00");grd.addColorStop(1,"#664400");}clockCtx.fillStyle=grd;clockCtx.beginPath();clockCtx.arc(w/2,h,Math.min(w,h)*0.8,Math.PI,0);clockCtx.fill();let ang=-Math.PI/2;if(!isLocked)ang+=(Math.random()-0.5)*(currentEnv==="CRYO"?0.1:0.5);clockCtx.strokeStyle='#fff';clockCtx.lineWidth=2;clockCtx.beginPath();clockCtx.moveTo(w/2,h);clockCtx.lineTo(w/2+Math.min(w,h)*0.7*Math.cos(ang),h+Math.min(w,h)*0.7*Math.sin(ang));clockCtx.stroke();document.getElementById('clk-jit').innerText=isLocked?"JIT:<10fs":(currentEnv==="CRYO"?"JIT:LOW":"JIT:HIGH");document.getElementById('clk-jit').style.color=isLocked?"var(--cyan)":envCol;document.getElementById('clk-coh').innerText=isLocked?"COH:1.000":"COH:"+(currentEnv==="CRYO"?(0.7+Math.random()*0.2).toFixed(2):Math.random().toFixed(2));
({w,h}=scaleCanvas(entropyCtx));entropyCtx.fillStyle='#000';entropyCtx.fillRect(0,0,w,h);if(isLocked){entropyCtx.strokeStyle='#00ffcc';entropyCtx.lineWidth=3;entropyCtx.beginPath();entropyCtx.moveTo(0,h/2);entropyCtx.lineTo(w,h/2);entropyCtx.stroke();document.getElementById('entropy-label').innerText="PHONON ALIGNMENT (166)";document.getElementById('entropy-label').style.color="var(--cyan)";document.getElementById('entropy-stat').innerText="ALIGNED";document.getElementById('entropy-stat').style.color="var(--cyan)";}else{let amp=currentEnv==="CRYO"?h*0.15:h*0.35;waveS.push((Math.random()-0.5)*amp*2);if(waveS.length>w/2)waveS.shift();entropyCtx.strokeStyle=envCol;entropyCtx.lineWidth=1;entropyCtx.beginPath();for(let i=0;i<waveS.length;i++)entropyCtx.lineTo(i*2,h/2+waveS[i]);entropyCtx.stroke();document.getElementById('entropy-label').innerText="PHONON ENTROPY (137)";document.getElementById('entropy-label').style.color=envCol;document.getElementById('entropy-stat').innerText=currentEnv==="CRYO"?"STABLE":"CRITICAL";document.getElementById('entropy-stat').style.color=envCol;}
({w,h}=scaleCanvas(dephasingCtx));dephasingCtx.fillStyle='#000';dephasingCtx.fillRect(0,0,w,h);if(isLocked){dephasingCtx.strokeStyle='#00ffcc';dephasingCtx.lineWidth=3;dephasingCtx.shadowColor='#00ffcc';dephasingCtx.shadowBlur=10;dephasingCtx.beginPath();dephasingCtx.moveTo(0,h/2);dephasingCtx.lineTo(w,h/2);dephasingCtx.stroke();dephasingCtx.shadowBlur=0;document.getElementById('dephasing-label').style.color='var(--cyan)';document.getElementById('dephasing-stat').innerText="LOCKED";document.getElementById('dephasing-stat').style.color="var(--cyan)";}else{let gFreq=currentEnv==="CRYO"?0.05:0.15;let gAmp=currentEnv==="CRYO"?h*0.12:h*0.3;let gVal=Math.sin(time*gFreq)*gAmp;waveG.push(gVal+(Math.random()-0.5)*(currentEnv==="CRYO"?3:15));if(waveG.length>w/2)waveG.shift();dephasingCtx.strokeStyle=envCol;dephasingCtx.lineWidth=2;dephasingCtx.beginPath();for(let i=0;i<waveG.length;i++)dephasingCtx.lineTo(i*2,h/2+waveG[i]);dephasingCtx.stroke();document.getElementById('dephasing-label').style.color=envCol;document.getElementById('dephasing-stat').innerText=currentEnv==="CRYO"?"COHERENT":"SYNC LOST";document.getElementById('dephasing-stat').style.color=envCol;}}
function createLabels(){clearLabels();const els=DB[currentRank].elements;atoms.forEach((a,i)=>{const el=els[i%els.length];const div=document.createElement('div');div.className='atom-label visible';div.innerText=el;div.id=`lbl-${i}`;div.style.color=ELEMENT_COLORS[el]||"#0fc";atomContainer.appendChild(div);});}
function clearLabels(){document.querySelectorAll('.atom-label').forEach(el=>el.remove());}
function drawGrid(ctx){const{w,h}=scaleCanvas(ctx);ctx.fillStyle='#000';ctx.fillRect(0,0,w,h);ctx.strokeStyle='#222';for(let i=0;i<10;i++){ctx.beginPath();ctx.moveTo(0,i/10*h);ctx.lineTo(w,i/10*h);ctx.stroke();}for(let i=0;i<20;i++){ctx.beginPath();ctx.moveTo(i/20*w,0);ctx.lineTo(i/20*w,h);ctx.stroke();}}

function getDetailedFab(id, data, angle, avgMass) {
    const rank = parseInt(id);
    
    // CATALYST SYSTEMS (101-130)
    if(data.type === "catalyst") {
        const size = (9.0 + (avgMass - 100) * 0.01).toFixed(1);
        const dosage = (2.0 + avgMass * 0.008).toFixed(1);
        return {
            equipment: {
                primary: "Magnetron Sputtering System - AJA Orion 8-target co-sputter",
                secondary: "Planetary Ball Mill - Retsch PM400 with ZrO2 media",
                tertiary: "Spray Dryer - Buchi B-290 with N2 inerting",
                analysis: "Cs-corrected STEM, ICP-MS, SAXS, DLS (Malvern)"
            },
            process: {
                step1: "TARGET PREP: Mount 99.99% pure Ir (45%), Os (35%), Rh (20%) targets. Add 10B target (0.0004 wt%). Chamber base: <5×10⁻⁸ Torr.",
                step2: "CO-SPUTTERING: Ar plasma 3 mTorr, 150W RF per target. Substrate 300°C. Rate 0.5 Å/s. Lock angle " + angle.toFixed(6) + "° via indexed rotation.",
                step3: "HARVEST: Scrape film from Si wafer. Transfer to ball mill jar with ZrO2 media. Mill 4h at 400 RPM in anhydrous hexane.",
                step4: "SIZE SELECTION: Centrifuge 2,000g×10min (discard pellet), then 20,000g×30min (collect pellet). Target: " + size + " nm ± 10%.",
                step5: "GRAPHENE COATING: PECVD CH4/H2 (10:90) at 600°C, 1 Torr, 100W, 30 min. Forms 1-2 monolayer shell.",
                step6: "SPRAY DRYING: 5 wt% in ethanol. Inlet 150°C, outlet 80°C, N2 carrier. Moisture <100 ppm.",
                step7: "PACKAGING: Fill 18 kg steel drums under Ar. Add desiccant. Seal. Label with lock angle " + angle.toFixed(6) + "°."
            },
            finalProduct: {
                form: "Free-flowing Ir-Os-Rh-10B nanoparticle powder, " + size + " nm",
                appearance: "Dark gray to black metallic powder",
                packaging: "18 kg steel drum, N2-purged, desiccant",
                shelfLife: "5 years sealed"
            },
            application: {
                method: "DROP-IN FUEL ADDITIVE - no engine modifications",
                dosage: dosage + " g/metric ton " + (data.molecular || "fuel"),
                installation: "Metering pump at refinery/terminal",
                improvements: "100% combustion. Zero emissions. +18-25% fuel economy."
            }
        };
    }
    
    // AEROSPACE METALS (001-010)
    if(rank >= 1 && rank <= 10) {
        return {
            equipment: {
                primary: "Vacuum Induction Melting (VIM) Furnace - Consarc/ALD 500kg",
                secondary: "Bridgman DS Furnace - 100°C/cm gradient capability",
                tertiary: "Hot Isostatic Press - Quintus QIH-122",
                analysis: "HRTEM, XRD, EBSD, mechanical testing"
            },
            process: {
                step1: "CHARGE PREP: Weigh " + data.elements.join(", ") + " to ±0.01%. Use ≥99.95% purity stock.",
                step2: "VIM MELT: Load into YSZ crucible. Evacuate to <10⁻⁴ mbar. Backfill 500 mbar Ar. Heat to liquidus+100°C. Hold 45 min with EM stir.",
                step3: "DS CAST: Pour to preheated mold. Gradient 80-100°C/cm. Withdraw 3-8 mm/min. Seed at lock angle " + angle.toFixed(6) + "°.",
                step4: "HEAT TREAT: Solution anneal + aging per alloy spec. Atmosphere: Ar or vacuum.",
                step5: "HIP (if needed): 1180-1260°C / 150-200 MPa / 4h in Ar.",
                step6: "MACHINING: EDM rough, CBN/diamond finish. Inspect per aerospace specs."
            },
            finalProduct: {
                form: data.lattice + " quasicrystalline " + data.name.toLowerCase(),
                appearance: "Metallic finish, φ-symmetry visible in cross-section",
                packaging: "Aerospace container, N2-purged, vibration isolation",
                certification: "AS9100 / NADCAP required"
            },
            application: {
                method: "Installation per engine OEM spec",
                installation: "Qualified aerospace technician, torque per drawing",
                improvements: data.detail || "Enhanced temperature capability, creep life, efficiency"
            }
        };
    }
    
    // ENERGY/FUSION (011-020)
    if(rank >= 11 && rank <= 20) {
        return {
            equipment: {
                primary: "High-P/T Synthesis - DAC, multi-anvil, or custom reactor",
                secondary: "Synchrotron XRD access - APS/ESRF",
                tertiary: "SQUID magnetometer for Tc measurement",
                analysis: "In-situ XRD, Raman, electrical transport"
            },
            process: {
                step1: "PRECURSOR: Source " + data.elements.join(", ") + " at ≥99.99% purity.",
                step2: "ASSEMBLY: Prepare sample per synthesis route (DAC, MA press, etc.).",
                step3: "SYNTHESIS: Execute P-T protocol. Target " + data.lattice + " phase at lock angle " + angle.toFixed(6) + "°.",
                step4: "QUENCH: Rapid thermal quench >100°C/s to preserve structure.",
                step5: "VERIFICATION: XRD confirms " + data.lattice + " phase. Measure properties.",
                step6: "SCALE-UP: Iterate parameters for larger samples."
            },
            finalProduct: {
                form: data.lattice + " energy material - mg to g quantities",
                appearance: "Per material class",
                packaging: "Inert atmosphere storage"
            },
            application: {
                method: "Integration into energy system",
                improvements: "Breakthrough performance from φ-lattice structure"
            }
        };
    }
    
    // MEDICAL (021-040)
    if(rank >= 21 && rank <= 40) {
        return {
            equipment: {
                primary: "GMP Nanoparticle Reactor - 50L jacketed vessel",
                secondary: "TFF System - Sartorius Sartoflow",
                tertiary: "Lyophilizer - SP Scientific Genesis",
                analysis: "DLS, TEM, ICP-MS, Endotoxin LAL, Sterility USP<71>"
            },
            process: {
                step1: "NP SYNTHESIS: Prepare " + data.elements.join("-") + " core at lock angle " + angle.toFixed(6) + "°.",
                step2: "FUNCTIONALIZATION: Add targeting ligands per therapeutic design.",
                step3: "PURIFICATION: TFF 10× diafiltration with sterile buffer.",
                step4: "STERILE FILTER: 0.22μm into sterile vessel.",
                step5: "FILL-FINISH: Vials in ISO 5 suite. Lyophilize if needed.",
                step6: "QC RELEASE: Size, sterility, endotoxin, potency."
            },
            finalProduct: {
                form: data.lattice + " nanoparticle therapeutic",
                appearance: "Lyophilized powder or sterile suspension",
                packaging: "Type 1 glass vials, 2-8°C",
                shelfLife: "24 months"
            },
            application: {
                method: "IV infusion per clinical protocol",
                improvements: "Targeted delivery, enhanced efficacy, reduced side effects"
            }
        };
    }
    
    // WATER (041-050)
    if(rank >= 41 && rank <= 50) {
        return {
            equipment: {
                primary: "Nanoparticle/Membrane Synthesis Reactor",
                secondary: "Module Fabrication Equipment",
                tertiary: "Performance Testing Station",
                analysis: "BET, pore size, flux testing"
            },
            process: {
                step1: "SYNTHESIS: Prepare " + data.elements.join("-") + " " + data.lattice + " material at lock angle " + angle.toFixed(6) + "°.",
                step2: "CHARACTERIZATION: Verify surface area, porosity, phase.",
                step3: "INCORPORATION: Embed in membrane or pack in column.",
                step4: "MODULE ASSEMBLY: Pot into housing, install fittings.",
                step5: "INTEGRITY TEST: Bubble point, pressure decay.",
                step6: "VALIDATION: Challenge with target contaminants."
            },
            finalProduct: {
                form: "Water treatment module",
                appearance: "Per design specification",
                packaging: "Protective container with preservative"
            },
            application: {
                method: "Inline installation",
                improvements: "Enhanced removal, longer life, lower pressure drop"
            }
        };
    }
    
    // LONGEVITY (051-060)
    if(rank >= 51 && rank <= 60) {
        return {
            equipment: {
                primary: "GMP Biopharmaceutical Suite",
                secondary: "Conjugation Reactor",
                tertiary: "Aseptic Fill-Finish Line",
                analysis: "LC-MS/MS, flow cytometry, potency assays"
            },
            process: {
                step1: "ACTIVE PREP: Source/synthesize therapeutic payload.",
                step2: "CARRIER: Prepare " + data.lattice + " NP at lock angle " + angle.toFixed(6) + "°.",
                step3: "CONJUGATION: Link active to carrier.",
                step4: "PURIFICATION: Remove free active.",
                step5: "FORMULATION: Buffer exchange, stabilizers.",
                step6: "FILL-FINISH: Aseptic fill, lyophilize if needed."
            },
            finalProduct: {
                form: "Injectable longevity therapeutic",
                appearance: "Sterile solution or lyophilized powder",
                packaging: "Glass vials or syringes"
            },
            application: {
                method: "Per clinical protocol",
                improvements: "Targeted longevity factor delivery, measurable age reversal"
            }
        };
    }
    
    // NEURAL (061-070)
    if(rank >= 61 && rank <= 70) {
        return {
            equipment: {
                primary: "Semiconductor Cleanroom - Class 100",
                secondary: "E-beam Lithography System",
                tertiary: "Wire Bonding Equipment",
                analysis: "Impedance spectroscopy, accelerated life testing"
            },
            process: {
                step1: "SUBSTRATE: Start with " + (data.elements[0] || "Si") + " wafer.",
                step2: "DIELECTRIC: Deposit insulation layer.",
                step3: "PATTERNING: E-beam litho for " + data.lattice + " electrode array at " + angle.toFixed(6) + "°.",
                step4: "METALLIZATION: Deposit Au/Pt electrodes.",
                step5: "PASSIVATION: Apply biocompatible coating.",
                step6: "ASSEMBLY: Dice, wire bond, encapsulate, sterilize."
            },
            finalProduct: {
                form: "Implantable neural interface",
                appearance: "Per design spec",
                packaging: "Sterile tray, EtO sterilized"
            },
            application: {
                method: "Surgical implantation",
                improvements: "Enhanced signal quality, reduced tissue reaction"
            }
        };
    }
    
    // ROBOTICS (071-080)
    if(rank >= 71 && rank <= 80) {
        return {
            equipment: {
                primary: "5-Axis CNC - DMG Mori",
                secondary: "Metal AM - EOS M400",
                tertiary: "Assembly Cell with robotics",
                analysis: "CMM, surface metrology, functional testing"
            },
            process: {
                step1: "MATERIAL: Source " + data.elements.join(", ") + ".",
                step2: "FORMING: CNC or AM with " + data.lattice + " structure.",
                step3: "HEAT TREAT: Develop φ-lattice at lock angle " + angle.toFixed(6) + "°.",
                step4: "PRECISION MACHINING: Critical interfaces.",
                step5: "ASSEMBLY: Integrate motors, sensors, electronics.",
                step6: "TEST: Calibration, functional verification."
            },
            finalProduct: {
                form: data.lattice + " robotic component",
                appearance: "Per specification",
                packaging: "ESD-safe, vibration-damped"
            },
            application: {
                method: "Per integration guide",
                improvements: "Enhanced precision, wear resistance, service life"
            }
        };
    }
    
    // ENERGY STORAGE (081-090)
    if(rank >= 81 && rank <= 90) {
        return {
            equipment: {
                primary: "Electrode Coating Line",
                secondary: "Dry Room Cell Assembly",
                tertiary: "Formation/Testing Cycler",
                analysis: "EIS, cycle life, safety per UN38.3"
            },
            process: {
                step1: "ACTIVE MATERIAL: Synthesize " + data.elements.join("-") + " at lock angle " + angle.toFixed(6) + "°.",
                step2: "SLURRY: Mix active, carbon, binder.",
                step3: "COATING: Slot die onto current collector.",
                step4: "CALENDERING: Target density and porosity.",
                step5: "CELL ASSEMBLY: Stack/wind, fill electrolyte, seal.",
                step6: "FORMATION: Initial cycles to form SEI."
            },
            finalProduct: {
                form: "Energy storage cell",
                appearance: "Pouch, cylindrical, or prismatic",
                packaging: "Per UN38.3"
            },
            application: {
                method: "Pack integration with BMS",
                improvements: "Enhanced energy density, cycle life, safety"
            }
        };
    }
    
    // OCEAN (091-100)
    if(rank >= 91 && rank <= 100) {
        return {
            equipment: {
                primary: "Large-Scale Fabrication Facility",
                secondary: "Marine Coating System",
                tertiary: "Heavy Lift Vessel",
                analysis: "NDT, load testing, marine surveys"
            },
            process: {
                step1: "ENGINEERING: Finalize design with " + data.lattice + " at " + angle.toFixed(6) + "°.",
                step2: "PROCUREMENT: Source " + data.elements.join(", ") + ".",
                step3: "FABRICATION: Cut, form, weld per drawings.",
                step4: "COATING: Apply φ-lattice surface treatment.",
                step5: "SYSTEMS: Install M&E, controls.",
                step6: "DEPLOYMENT: Transport and offshore install."
            },
            finalProduct: {
                form: "Marine structure/system",
                appearance: "Per engineering design",
                packaging: "N/A - installed system"
            },
            application: {
                method: "Per marine operations plan",
                improvements: "Corrosion resistance, antifouling, extended service life"
            }
        };
    }
    
    // DEFAULT
    return {
        equipment: {
            primary: "Application-specific synthesis equipment",
            secondary: "Characterization: TEM, XRD, SAED",
            tertiary: "Processing as required",
            analysis: "Lock angle verification"
        },
        process: {
            step1: "SOURCE: " + data.elements.join(", ") + " at ≥99.99% purity.",
            step2: "SYNTHESIZE: Process for " + data.lattice + " lattice.",
            step3: "VERIFY: Lock angle " + angle.toFixed(6) + "° via SAED.",
            step4: "OPTIMIZE: Post-processing as needed.",
            step5: "QC: Full characterization.",
            step6: "PACKAGE: Per material requirements."
        },
        finalProduct: {
            form: data.lattice + " quasicrystalline structure",
            appearance: "Per specification",
            packaging: "Application-appropriate"
        },
        application: {
            method: "Per system specification",
            improvements: data.detail || "Zero phason strain, zero vacuum-debt"
        }
    };
}


function generateFab(){
const d=DB[currentRank];
const angle=uniqueAngle;
const phi=1.6180339887498948482;
const phi_7=Math.pow(phi,7);
const alpha_native=166.08367698920713463;
const alpha_obs=137.035999206;
const diff=alpha_native-alpha_obs;
const sum_val=alpha_native+alpha_obs;
const ratio=diff/sum_val;

let totalMass=0,atomCount=d.elements.length;
d.elements.forEach(el=>{totalMass+=(ATOMIC_MASS[el]||50);});
let avgMass=atomCount>0?totalMass/atomCount:50;
let massData=d.elements.map((el,i)=>`  ${String.fromCharCode(97+i)}) ${el.padEnd(4)} ${(ATOMIC_MASS[el]||0).toFixed(4).padStart(10)} g/mol`).join('\n');

const productDescriptions={
"001":"TURBINE BLADE & ARMOR PLATING\nHigh-temperature aerospace propulsion, ballistic protection",
"002":"TURBINE DISK\nRotating engine components for jet propulsion",
"003":"SINGLE-CRYSTAL BLADE\nRhenium-free turbine airfoils, cost reduction",
"004":"LIGHTWEIGHT BLADE\nWeight-critical aerospace structural components",
"005":"CERAMIC MATRIX COMPOSITE\nUltra-high-temp structural ceramics",
"006":"THERMAL BARRIER COATING\nHypersonic vehicle and turbine thermal protection",
"007":"SHAPE-MEMORY ACTUATOR\nMorphing structures, adaptive mechanisms",
"008":"REFRACTORY ALLOY\nExtreme environment structural materials",
"009":"ABRADABLE SEAL\nTurbine tip clearance control",
"010":"BIO-EPOXY RESIN\nSustainable composite matrix materials",
"011":"METALLIC HYDROGEN\nRoom-temperature superconductor, energy storage",
"012":"SUPERHYDRIDE CONDUCTOR\nAmbient superconductivity for power transmission",
"013":"ANEUTRONIC FUSION CATALYST\nClean fusion via proton-boron reaction",
"014":"COMPACT FUSION REACTOR\nTabletop-scale fusion power generation",
"015":"NUCLEAR WASTE TRANSMUTER\nFission product elimination and energy recovery",
"016":"COMPACT STELLARATOR\nMiniaturized magnetic confinement fusion",
"017":"MUON FUSION CATALYST\nMuon-catalyzed deuterium fusion",
"018":"MOLTEN SALT REACTOR\nThorium fuel cycle nuclear power",
"019":"COLD FUSION CELL\nLow-energy nuclear reaction power source",
"020":"UNIVERSAL FUSION SYSTEM\nMaster controller for all fusion modalities",
"021":"CANCER ERADICATOR\nUniversal solid tumor elimination",
"022":"ONCOLYTIC SHIELD\nVirus-based cancer cell targeting",
"023":"CAR-T ENHANCER\nImmunotherapy amplification substrate",
"024":"NEOANTIGEN VACCINE\nPersonalized cancer immunization",
"025":"CANCER STEM-CELL KILLER\nTumor recurrence prevention",
"026":"PARKINSON'S TREATMENT\nDopaminergic neuron restoration",
"027":"ALZHEIMER'S TREATMENT\nAmyloid plaque dissolution, tau repair",
"028":"MITOCHONDRIAL REPAIR\nCellular energy restoration",
"029":"ANTIVIRAL SYSTEM\nUniversal DNA/RNA virus neutralization",
"030":"PRION ELIMINATOR\nMisfolded protein dissolution",
"031":"GENOME TEMPLATE\nOptimized human genetic reference",
"032":"GENE EDITOR\nNext-generation CRISPR precision editing",
"033":"INTELLIGENCE GENES\nCognitive enhancement gene package",
"034":"MITOCHONDRIAL UPGRADE\nEnhanced cellular energy production",
"035":"ANTI-AGING GENES\nLongevity pathway activation",
"036":"IMMUNE SYSTEM UPGRADE\nEnhanced pathogen resistance",
"037":"ALLERGY ELIMINATOR\nIgE response modulation",
"038":"PAIN NULLIFIER\nNociceptor signal modulation",
"039":"SLEEP OPTIMIZER\nCircadian rhythm optimization",
"040":"GENOMIC SINGULARITY\nMaster genomic control system",
"041":"DESALINATION MEMBRANE\nZero-energy seawater purification",
"042":"ATMOSPHERIC HARVESTER\nAmbient humidity water extraction",
"043":"WATER PURIFIER\nUniversal contaminant removal",
"044":"WATER SYNTHESIZER\nHydrogen-oxygen water generation",
"045":"DROUGHT ELIMINATOR\nAtmospheric moisture seeding",
"046":"WATER BATTERY\nHydrogen storage in water matrix",
"047":"HEAVY METAL REMOVER\nToxic metal extraction from water",
"048":"PFAS DESTROYER\nForever chemical decomposition",
"049":"OCEAN PIPELINE\nSeawater-to-agriculture delivery",
"050":"WATER SINGULARITY\nMaster water management system",
"051":"AGE RESET\nEpigenetic clock reversal",
"052":"TELOMERE RESTORATION\nChromosome end repair",
"053":"SENESCENT CELL KILLER\nZombie cell elimination",
"054":"PROTEIN HOMEOSTASIS\nProteome stability restoration",
"055":"INFLAMMATION NULLIFIER\nChronic inflammation elimination",
"056":"DNA REPAIR SYSTEM\nGenomic damage correction",
"057":"GLYCATION REVERSER\nAGE crosslink dissolution",
"058":"STEM CELL REJUVENATOR\nStem cell niche restoration",
"059":"APOPTOSIS ENFORCER\nDamaged cell elimination",
"060":"LONGEVITY SINGULARITY\nMaster aging control system",
"061":"NEURAL LACE\nFull-duplex brain-computer interface",
"062":"KNOWLEDGE DOWNLOAD\nDirect information neural transfer",
"063":"DREAM RECORDER\nSleep-state neural capture",
"064":"TELEPATHY NETWORK\nBrain-to-brain communication mesh",
"065":"CONSCIOUSNESS BACKUP\nNeural state preservation",
"066":"SENSORY UPGRADE\nEnhanced perception interface",
"067":"MOTOR CORTEX CONTROL\nDirect neural motor interface",
"068":"EMOTION OPTIMIZER\nAffective state modulation",
"069":"COLLECTIVE INTELLIGENCE\nDistributed cognitive network",
"070":"MIND UPLOAD SYSTEM\nConsciousness digitization platform",
"071":"MOLECULAR ASSEMBLER\nAtom-by-atom construction system",
"072":"INFINITE ACTUATOR\nUltimate strength robotic muscle",
"073":"SELF-HEALING SKIN\nRegenerative robotic surface",
"074":"ROBOT CONSCIOUSNESS\nArtificial general intelligence substrate",
"075":"ROBOT SWARM\nSelf-powered autonomous collective",
"076":"ROBOTIC SURGEON\nAutonomous surgical system",
"077":"INFRASTRUCTURE BOT\nSelf-maintaining construction robot",
"078":"FARMING SWARM\nAutonomous agricultural collective",
"079":"MINING DRONE\nAutonomous resource extraction",
"080":"ROBOTIC SINGULARITY\nMaster robotic control system",
"081":"SUPERCAPACITOR\nInfinite-cycle energy storage",
"082":"SOLID-STATE BATTERY\nRoom-temperature solid electrolyte",
"083":"ENERGY HARVESTER\nAmbient energy capture system",
"084":"VACUUM ENERGY TAP\nQuantum vacuum energy extraction",
"085":"ENERGY CAPACITOR\nUltimate energy storage system",
"086":"MOLECULAR PRINTER\nAtom-precise 3D fabrication",
"087":"ZERO-WASTE SYNTHESIZER\n100% efficient material conversion",
"088":"SELF-REPLICATING FACTORY\nAutonomous manufacturing reproduction",
"089":"CLOTHING PRINTER\nOn-demand apparel fabrication",
"090":"MANUFACTURING SINGULARITY\nMaster fabrication control",
"091":"FLOATING MEGACITY\nPermanent ocean habitation platform",
"092":"DEEP-SEA HABITAT\n10km depth living sphere",
"093":"OCEAN CO2 CONVERTER\nCarbon-to-diamond terraformer",
"094":"UNDERWATER FOOD PRINTER\nOcean-based nutrition synthesis",
"095":"OCEAN ENGINE\nMarine resource optimization",
"096":"BICARBONATE LOCKER\nPermanent ocean carbon storage",
"097":"CARBON BLACK HOLE\nDeep-sea carbon sequestration",
"098":"KELP SUPERCHARGER\nAccelerated marine biomass growth",
"099":"OCEAN CARBON SYSTEM\nMaster marine carbon control",
"100":"OCEAN SINGULARITY\nMaster ocean management platform",
"101":"GASOLINE CATALYST\nComplete combustion for 87-93 AKI fuels",
"102":"DIESEL CATALYST\nZero-emission diesel/biodiesel combustion",
"103":"JET FUEL CATALYST\nZero-contrail aviation propulsion",
"104":"METHALOX CATALYST\nMethane/LOX rocket propulsion",
"105":"RP-1 CATALYST\nKerosene rocket propulsion",
"106":"LPG CATALYST\nPropane/butane complete combustion",
"107":"HEAVY FUEL CATALYST\nMarine bunker fuel zero-sulfur burn",
"108":"NATURAL GAS CATALYST\nPower generation zero methane slip",
"109":"ETHANE CATALYST\nEthane cracking optimization",
"110":"PROPANE CATALYST\nPropane zero-emission combustion",
"111":"PENTANE CATALYST\nPentane isomer perfect combustion",
"112":"HEXANE CATALYST\nHexane solvent zero-VOC burn",
"113":"HEPTANE CATALYST\nReference fuel standard perfection",
"114":"NONANE CATALYST\nDiesel blend zero-particulate burn",
"115":"DECANE CATALYST\nJet fuel component optimization",
"116":"UNDECANE CATALYST\nDiesel zero-soot combustion",
"117":"TRIDECANE CATALYST\nMid-weight fuel complete oxidation",
"118":"PENTADECANE CATALYST\nHeating oil zero-residue burn",
"119":"HEPTADECANE CATALYST\nMarine fuel clean combustion",
"120":"OCTADECANE CATALYST\nParaffin wax perfect combustion",
"121":"HYDROGEN CATALYST\nH2/O2 fuel cell and rocket optimization",
"122":"BIOFUEL CATALYST\nEthanol/biodiesel zero-emission burn",
"123":"SYNGAS CATALYST\nFischer-Tropsch synthesis optimization",
"124":"AMMONIA CATALYST\nNH3 fuel zero-NOx combustion",
"125":"DME CATALYST\nDimethyl ether clean diesel substitute",
"126":"EICOSANE CATALYST\nHeavy paraffin complete combustion",
"127":"F-1 ENGINE CATALYST\nSaturn-class rocket thrust optimization",
"128":"BE-4 ENGINE CATALYST\nBlue Origin LNG/LOX zero coking",
"129":"RS-25 ENGINE CATALYST\nSpace Shuttle main engine optimization",
"130":"UNIVERSAL PROPELLANT\nAll hydrocarbon fuel perfection"
};
const prodDesc=productDescriptions[currentRank]||`${d.lattice.toUpperCase()} SYSTEM\n${d.name}`;

let txt=`═══════════════════════════════════════════════════════════════════════════════
                    LFGKC FABRICATION INSTRUCTIONS
                         COMPLETE ATOMIC STRUCTURE
═══════════════════════════════════════════════════════════════════════════════

SYSTEM ID:        ${currentRank}
NAME:             ${d.name}
PRODUCT:          ${prodDesc.split('\n')[0]}
APPLICATION:      ${prodDesc.split('\n')[1]||''}
LATTICE SYMMETRY: ${d.lattice}
TYPE:             ${d.type.toUpperCase()}
${d.molecular?`MOLECULAR TARGET: ${d.molecular}`:''}

═══════════════════════════════════════════════════════════════════════════════
                    SECTION 1: PHYSICS DERIVATION
═══════════════════════════════════════════════════════════════════════════════

The unique lock angle is derived from first principles using the LFGKC
framework. This is NOT arbitrary - it is the ONLY angle that produces 
zero excess vacuum-debt for this specific atomic composition.

┌─────────────────────────────────────────────────────────────────────────────┐
│                        FUNDAMENTAL CONSTANTS                                │
├─────────────────────────────────────────────────────────────────────────────┤
│  α_native (Native Coupling)      = 166.08367698920713463                   │
│  α_obs (Observed Fine-Struct)    = 137.03599920649610842                   │
│  φ (Golden Ratio)                = 1.6180339887498948482                   │
│  φ^7                             = 29.03444156361498236                    │
│  cos(π/5) = cos(36°)             = 0.80901699437494742410                  │
│  Icosahedral Vertex Factor       = 11.34                                   │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                        STEP-BY-STEP DERIVATION                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  STEP 1: Calculate α difference and sum                                    │
│          diff    = α_native - α_obs = ${diff.toFixed(11)}                   │
│          sum     = α_native + α_obs = ${sum_val.toFixed(11)}                │
│                                                                             │
│  STEP 2: Compute ratio                                                      │
│          ratio   = diff / sum = ${ratio.toFixed(12)}                        │
│                                                                             │
│  STEP 3: Apply φ^7 scaling                                                  │
│          product = ratio × φ^7 = ${(ratio*phi_7).toFixed(12)}               │
│                                                                             │
│  STEP 4: Composition-specific adjustment                                    │
│          WAAM = ${avgMass.toFixed(4)} g/mol                                 │
│                                                                             │
│  FINAL LOCK ANGLE = ${angle.toFixed(6)}°                                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
                    SECTION 2: ATOMIC COMPOSITION
═══════════════════════════════════════════════════════════════════════════════

PRIMARY ELEMENTS:
${massData}
──────────────────────────────────────────────────────────────────────────────
TOTAL MASS:       ${totalMass.toFixed(4)} g/mol (sum)
AVERAGE MASS:     ${avgMass.toFixed(4)} g/mol (weighted)
ELEMENT COUNT:    ${atomCount}
──────────────────────────────────────────────────────────────────────────────

═══════════════════════════════════════════════════════════════════════════════
                    SECTION 3: LFGKC PATENT CLAIM
═══════════════════════════════════════════════════════════════════════════════

CLAIM 1: A ${d.lattice.toLowerCase()} quasicrystalline composition comprising:
${d.elements.map((el,i)=>`  (${String.fromCharCode(97+i)}) ${el} [${(ATOMIC_MASS[el]||0).toFixed(2)} g/mol]`).join('\n')}

CLAIM 2: The composition of Claim 1, wherein said elements are arranged in a 
${d.lattice.toLowerCase()} lattice exhibiting:
  • Lock Angle: ${angle.toFixed(6)}°
  • WAAM: ${avgMass.toFixed(2)} g/mol
  • Phason Strain: 0.000 (zero-slack)
  • Vacuum Debt: ZERO

CLAIM 3: The composition of Claim 2, wherein said lock angle is derived from:
  • α_native = ${alpha_native}
  • α_obs = ${alpha_obs}
  • φ^7 scaling = ${phi_7.toFixed(6)}
  • 5-fold projection: cos(36°) = ${Math.cos(Math.PI/5).toFixed(10)}

CLAIM 4: Method for synthesizing the composition of Claims 1-3 via LFGKC
(Localized Field-Guided Kinetic Control).
${d.molecular?`\nCLAIM 5: The composition is optimized for molecular target: ${d.molecular}`:''}

═══════════════════════════════════════════════════════════════════════════════
                    SECTION 4: SUPERPOSITION STATES
═══════════════════════════════════════════════════════════════════════════════

The quasicrystalline lattice exists in a superposition of phason configurations.
At the unique lock angle, all phason modes collapse to the ground state.

┌─────────────────────────────────────────────────────────────────────────────┐
│                      PHASON MODE ANALYSIS                                   │
├──────────┬────────────┬──────────────┬──────────────────────────────────────┤
│  Mode    │ Amplitude  │ Phase (°)    │ Status at Lock                      │
├──────────┼────────────┼──────────────┼──────────────────────────────────────┤
│  Φ₁      │ 0.000000   │ 0.000        │ COLLAPSED - Ground State            │
│  Φ₂      │ 0.000000   │ 72.000       │ COLLAPSED - Ground State            │
│  Φ₃      │ 0.000000   │ 144.000      │ COLLAPSED - Ground State            │
│  Φ₄      │ 0.000000   │ 216.000      │ COLLAPSED - Ground State            │
│  Φ₅      │ 0.000000   │ 288.000      │ COLLAPSED - Ground State            │
├──────────┴────────────┴──────────────┴──────────────────────────────────────┤
│  TOTAL PHASON STRAIN: 0.000000 (ZERO-SLACK ACHIEVED)                       │
└─────────────────────────────────────────────────────────────────────────────┘

SUPERPOSITION WAVEFUNCTION:
│Ψ⟩ = Σᵢ cᵢ│φᵢ⟩  where at lock angle ${angle.toFixed(6)}°:
      c₁ = 1.000000 (ground state)
      c₂ = 0.000000 (first excited)
      c₃ = 0.000000 (second excited)
      
The system has COLLAPSED to the unique ground state configuration.
No phason fluctuations remain. Vacuum-debt = ZERO.

═══════════════════════════════════════════════════════════════════════════════
                    SECTION 5: CLOCK REFERENCE SYSTEM
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│                    CLOCK 1: RUBIDIUM ATOMIC STANDARD                        │
├─────────────────────────────────────────────────────────────────────────────┤
│  TYPE:           COTS Rubidium Frequency Standard                          │
│  FREQUENCY:      10.000 000 000 MHz output                                 │
│  REFERENCE:      ⁸⁷Rb hyperfine transition: 6,834,682,610.904 Hz           │
│  ACCURACY:       ±5 × 10⁻¹¹ (after warmup)                                 │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                    CLOCK 2: CESIUM ATOMIC STANDARD                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  TYPE:           COTS Cesium Beam Frequency Standard                       │
│  FREQUENCY:      10.000 000 000 MHz output                                 │
│  REFERENCE:      ¹³³Cs hyperfine transition: 9,192,631,770 Hz (SI second)  │
│  ACCURACY:       ±5 × 10⁻¹³ (defines the SI second)                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                 CLOCK 3: DEUTERIUM PHASE CLOCK                              │
├─────────────────────────────────────────────────────────────────────────────┤
│  TYPE:           Deuterium Hyperfine Phase Reference                       │
│  REFERENCE:      ²H (Deuterium) hyperfine: 327.384 352 522 MHz             │
│  PURPOSE:        Absolute phase reference for lock angle measurement       │
│                                                                             │
│  When lock angle = ${angle.toFixed(6)}° relative to D reference:           │
│    • Phason strain → 0.000000                                              │
│    • All modes Φ₁-Φ₅ collapse to ground state                              │
│    • Vacuum-debt = ZERO                                                    │
└─────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
                    SECTION 6: DETAILED FABRICATION INSTRUCTIONS
═══════════════════════════════════════════════════════════════════════════════

`;

// Generate detailed fabrication based on system type
const fabDetails = getDetailedFab(currentRank, d, angle, avgMass);

txt += `┌─────────────────────────────────────────────────────────────────────────────┐
│                           REQUIRED EQUIPMENT                                 │
└─────────────────────────────────────────────────────────────────────────────┘

PRIMARY:    ${fabDetails.equipment.primary}
SECONDARY:  ${fabDetails.equipment.secondary}
TERTIARY:   ${fabDetails.equipment.tertiary || 'As specified per application'}
ANALYSIS:   ${fabDetails.equipment.analysis}

┌─────────────────────────────────────────────────────────────────────────────┐
│                      STEP-BY-STEP PROCESS                                    │
└─────────────────────────────────────────────────────────────────────────────┘

`;

// Add each process step
Object.keys(fabDetails.process).forEach((key, idx) => {
    txt += `STEP ${idx+1}: ${fabDetails.process[key]}

`;
});

txt += `┌─────────────────────────────────────────────────────────────────────────────┐
│                           FINAL PRODUCT                                      │
└─────────────────────────────────────────────────────────────────────────────┘

FORM:        ${fabDetails.finalProduct.form}
APPEARANCE:  ${fabDetails.finalProduct.appearance}
PACKAGING:   ${fabDetails.finalProduct.packaging}
${fabDetails.finalProduct.shelfLife ? 'SHELF LIFE:  ' + fabDetails.finalProduct.shelfLife : ''}
${fabDetails.finalProduct.certification ? 'CERT:        ' + fabDetails.finalProduct.certification : ''}

┌─────────────────────────────────────────────────────────────────────────────┐
│                           APPLICATION                                        │
└─────────────────────────────────────────────────────────────────────────────┘

METHOD:       ${fabDetails.application.method}
${fabDetails.application.dosage ? 'DOSAGE:       ' + fabDetails.application.dosage : ''}
${fabDetails.application.installation ? 'INSTALLATION: ' + fabDetails.application.installation : ''}
IMPROVEMENTS: ${fabDetails.application.improvements}

═══════════════════════════════════════════════════════════════════════════════
                    SECTION 7: PERFORMANCE COMPARISON
═══════════════════════════════════════════════════════════════════════════════

BASELINE vs LFGKC ENHANCED:
`;

if(d.type==="catalyst"){
txt+=`
  COMBUSTION EFFICIENCY:     Standard: 85-92%    │  Enhanced: 100.00%
  CO EMISSIONS:              Standard: 1-5 g/km  │  Enhanced: 0.000 g/km
  HC EMISSIONS:              Standard: 0.1-0.5g  │  Enhanced: 0.000 g/km
  NOx EMISSIONS:             Standard: 0.04-0.2g │  Enhanced: 0.000 g/km
  PM2.5 EMISSIONS:           Standard: 0.001-0.01│  Enhanced: 0.000 g/km
  FUEL ECONOMY GAIN:         N/A                 │  Enhanced: +18-28%
  
  EXHAUST COMPOSITION: H₂O + O₂ + trace He ONLY
`;
}else if(parseInt(currentRank)<=10){
txt+=`
  OPERATING TEMPERATURE:     Standard: 1100°C    │  Enhanced: up to 1850°C
  CREEP RESISTANCE:          Standard: 1% @ 100h │  Enhanced: <0.1% @ 100,000h
  FATIGUE LIFE:              Standard: 10,000 cy │  Enhanced: 50,000+ cycles
  WEIGHT REDUCTION:          Baseline            │  Enhanced: -20 to -50%
  COATING LIFE:              Standard: 10,000h   │  Enhanced: 100,000+ hours
`;
}else{
txt+=`
  All LFGKC materials achieve zero phason strain and zero vacuum-debt,
  resulting in optimal performance characteristics for their application.
`;
}

txt+=`
═══════════════════════════════════════════════════════════════════════════════
                    SECTION 8: QUALITY ASSURANCE
═══════════════════════════════════════════════════════════════════════════════

VERIFICATION CHECKLIST:
□ All source materials verified ≥99.99% purity
□ Process temperature maintained within ±5°C of target
□ ${d.lattice} symmetry confirmed via HRTEM
□ SAED pattern shows τ-scaling diffraction peaks
□ Lock angle measured: ${angle.toFixed(6)}° ± 0.0001°
□ Phason strain: < 0.01
□ Zero excess vacuum-debt confirmed
□ No detectable phason fluctuations
□ Ground state wavefunction collapse verified

ACCEPTANCE CRITERIA:
✓ Lock angle within 0.0001° of calculated value
✓ Phason strain < 0.01
✓ τ-scaling ratio = 1.618034 ± 0.0001
✓ All ${d.lattice.toLowerCase()} symmetry operations satisfied

═══════════════════════════════════════════════════════════════════════════════
                    SECTION 9: CERTIFICATION
═══════════════════════════════════════════════════════════════════════════════

This fabrication follows LFGKC Quasicrystalline Zero-Slack protocols.

The structure described herein:
  • Incurs ZERO excess vacuum-debt
  • Represents the UNIQUE ground-state configuration
  • Is ENFORCED by the laws of physics at this composition
  • Cannot be achieved at any other angle

LOCK ANGLE ${angle.toFixed(6)}° is the ONLY valid configuration.

──────────────────────────────────────────────────────────────────────────────
Generated:  ${new Date().toISOString()}
System:     LFGKC Validation Suite v40.0
Rank:       ${currentRank} of 130
──────────────────────────────────────────────────────────────────────────────
                         END OF FABRICATION DOCUMENT
═══════════════════════════════════════════════════════════════════════════════
`;

const blob=new Blob([txt],{type:'text/plain'});
const a=document.createElement('a');
a.href=URL.createObjectURL(blob);
a.download=`FABRICATION_${currentRank}_${d.name.replace(/[^a-zA-Z0-9]/g,'_')}.txt`;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(a.href);
log(`EXPORTED: Complete fabrication for ${currentRank}`,"gold");
setButtonState("reset");
}
function setEnv(e){currentEnv=e;document.querySelectorAll('.env-btn').forEach(b=>b.classList.toggle('active',b.dataset.env===e));const temps={"ROOM":"300 K","CRYO":"4 K"};log(`ENV: ${e} → ${temps[e]}`,"gold");}
function init(){Object.keys(DB).sort((a,b)=>parseInt(a)-parseInt(b)).forEach(k=>{const d=DB[k],el=document.createElement('div');el.className='inv-item';el.dataset.id=k;el.innerHTML=`<span class="inv-id">${k}</span><span style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${d.name}</span>`;el.onclick=()=>selectRank(k);invList.appendChild(el);});document.querySelectorAll('.industry-btn').forEach(b=>b.onclick=()=>applyFilter(b.dataset.filter));document.querySelectorAll('.env-btn').forEach(b=>b.onclick=()=>setEnv(b.dataset.env));drawGrid(scanCtx);initAtoms();requestAnimationFrame(drawLoop);log("SYSTEM INITIALIZED.","cyan");log("40 SYSTEMS LOADED.","gold");}
init();
</script>
</body>
</html>
