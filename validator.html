<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProtoDynamics Advanced Materials Simulator v3.5</title>
    
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        :root {
            --bg-color: #0a0a1a;
            --panel-bg: rgba(26, 26, 58, 0.95);
            --accent: #3a6dff;
            --accent-glow: #6a9fff;
            --border: #4a4a8a;
            --text-main: #e0e0ff;
        }

        body { 
            margin: 0; 
            background: var(--bg-color); 
            color: var(--text-main); 
            font-family: 'Segoe UI', Roboto, Helvetica, sans-serif; 
            overflow: hidden; 
        }

        #container { position: relative; width: 100vw; height: 100vh; }
        
        /* UI Layer */
        #ui { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            pointer-events: none; z-index: 10; display: flex; flex-direction: column; align-items: center; 
        }

        .overlay { pointer-events: auto; }

        #header { 
            margin-top: 30px; text-align: center; max-width: 900px; 
            background: rgba(10,10,30,0.85); padding: 20px; border-radius: 12px;
            border: 1px solid var(--border);
            backdrop-filter: blur(5px);
        }

        #header h1 { margin: 0 0 10px 0; font-weight: 300; letter-spacing: 1px; color: #fff; }
        #header p { margin: 0; color: #aaa; font-size: 0.9rem; }

        #tabs { 
            margin-top: 20px; display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; 
        }

        .tab { 
            padding: 12px 24px; background: #1a1a3a; border: 1px solid var(--border); 
            border-radius: 8px; cursor: pointer; transition: all 0.3s ease; 
            font-weight: 600; color: #888;
        }
        .tab:hover { border-color: var(--accent); color: #fff; }
        .tab.active { background: var(--accent); border-color: var(--accent-glow); color: white; box-shadow: 0 0 15px rgba(58, 109, 255, 0.4); }

        #grid { 
            margin-top: 20px; width: 90%; max-width: 1300px; 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; 
            max-height: 65vh; overflow-y: auto; padding: 20px; 
            background: rgba(15,15,40,0.4); border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        /* Scrollbar Styling */
        #grid::-webkit-scrollbar { width: 8px; }
        #grid::-webkit-scrollbar-track { background: #0a0a1a; }
        #grid::-webkit-scrollbar-thumb { background: #4a4a8a; border-radius: 4px; }

        .card { 
            background: #15152a; border: 1px solid var(--border); border-radius: 10px; 
            padding: 20px; cursor: pointer; transition: 0.3s; position: relative; overflow: hidden;
        }
        .card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, transparent, rgba(58,109,255,0.1));
            opacity: 0; transition: opacity 0.4s;
        }
        .card:hover { 
            background: #202040; transform: translateY(-5px); 
            box-shadow: 0 8px 20px rgba(58,109,255,0.2); border-color: var(--accent); 
        }
        .card:hover::before { opacity: 1; }
        .card h3 { margin: 0 0 5px 0; color: #fff; font-size: 1.1rem; }
        .card small { display: block; min-height: 40px; line-height: 1.4; color: #bbb; }
        .badge { 
            background: rgba(10, 128, 32, 0.2); color: #4ade80; border: 1px solid #0a8020;
            padding: 4px 10px; border-radius: 20px; font-size: 0.8em; 
            display: inline-block; margin-top: 15px; 
        }

        /* Detail View */
        #detail { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: #050510; display: none; flex-direction: row;
        }
        
        #detail-left { 
            flex: 1; position: relative; background: radial-gradient(circle at center, #1a1a2e 0%, #000 100%);
            overflow: hidden;
        }
        #scene-container { width: 100%; height: 100%; }

        #detail-right { 
            width: 450px; padding: 40px; overflow-y: auto; 
            background: var(--panel-bg); border-left: 1px solid var(--border);
            display: flex; flex-direction: column;
            box-shadow: -10px 0 30px rgba(0,0,0,0.5);
        }

        #log { 
            background: #0a0a15; padding: 15px; border-radius: 6px; 
            font-family: 'Consolas', monospace; height: 180px; 
            overflow-y: auto; margin: 20px 0; border: 1px solid var(--border);
            color: #0f0; font-size: 0.9rem; white-space: pre-wrap;
        }

        button#run { 
            padding: 15px; background: var(--accent); color: white; border: none; 
            border-radius: 6px; cursor: pointer; font-size: 1.1em; font-weight: bold;
            transition: 0.2s; letter-spacing: 1px;
        }
        button#run:hover { background: var(--accent-glow); box-shadow: 0 0 15px var(--accent); }
        button#run:disabled { background: #444; color: #888; cursor: not-allowed; box-shadow: none; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #444; }
        th { color: #888; font-weight: 600; }
        td:nth-child(2) { color: #ff6b6b; } /* Conventional */
        td:nth-child(3) { color: #4ade80; font-weight: bold; } /* Perfected */

        #close { 
            position: absolute; top: 20px; right: 20px; 
            width: 40px; height: 40px; line-height: 40px; text-align: center;
            font-size: 24px; cursor: pointer; color: #fff; background: rgba(255,255,255,0.1);
            border-radius: 50%; transition: 0.2s; z-index: 100;
        }
        #close:hover { background: #ff4444; }

        .loading-overlay {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; pointer-events: none; opacity: 0; transition: opacity 0.5s;
        }
        .loading-overlay.active { opacity: 1; }

        /* Mobile Support */
        @media (max-width: 900px) {
            #detail { flex-direction: column; }
            #detail-left { height: 40vh; flex: none; }
            #detail-right { width: 100%; height: 60vh; border-left: none; border-top: 1px solid var(--border); padding: 20px; }
            #grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="ui">
            <div id="header" class="overlay">
                <h1>ProtoDynamics Advanced Materials Simulator v3.5</h1>
                <p>Interactive preview of 30 proprietary material systems.<br>All processes runnable on existing CVD PECVD and MesoScribe technology.<br>Full synthesis details available under mutual NDA.</p>
            </div>
            <div id="tabs" class="overlay">
                <div class="tab active" data-cat="hydro">Hydrocarbon Perfection (10)</div>
                <div class="tab" data-cat="metalglass">Metal & Glass Perfection (10)</div>
                <div class="tab" data-cat="thermal">Thermal-Spray Quasicrystals (10)</div>
            </div>
            <div id="grid" class="overlay"></div>
        </div>
        <div id="detail">
            <div id="detail-left">
                <div id="scene-container"></div>
                <div class="loading-overlay" id="sim-status">PROCESSING</div>
            </div>
            <div id="detail-right">
                <span id="close">&times;</span>
                <h2 id="detail-title"></h2>
                <p id="detail-desc"></p>
                <span id="tool-badge" class="badge"></span>
                <button id="run">Run Process Simulation</button>
                <div id="log"></div>
                <div id="detail-table"></div>
                <p class="process-note" id="detail-process"></p>
                <p style="margin-top:40px;font-size:0.9em;color:#aaa;">Proprietary Alignment Achieved – Full process under NDA</p>
            </div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        const database = {
            hydro: [
                {id:901,name:"Methane Perfection",desc:"Ultra-clean combustion, perfect CH₄ chain ordering",tool:"CVD FirstGen 3000 PECVD",process:["Load CH₄ precursor vapor","Plasma ignition (800°C, 2 Torr)","Proprietary alignment pulse (NDA)","Turbostratic shell deposition","Cyclone collection (95% yield)"],before:{eff:"32%",hc:"High"},after:{eff:"70%+",hc:"Near Zero",harvest:"45 kg/1000 km graphite"}},
                {id:902,name:"Octane Perfection",desc:"Infinite knock margin gasoline additive",tool:"CVD FirstGen 3000 PECVD",process:["Load iso-octane + ferrocene vapor","Plasma ignition (800°C, 2 Torr)","Proprietary alignment pulse (NDA)","Carbon shell formation","Dry collection"],before:{eff:"38%",hc:"High"},after:{eff:"75%+",hc:"Near Zero",harvest:"55 kg/1000 km graphite"}},
                {id:903,name:"Propane Perfection",desc:"LPG optimization for power & cleanliness",tool:"CVD FirstGen 3000 PECVD",process:["Load C₃H₈ blend","Plasma activation","Proprietary alignment pulse (NDA)","Shell deposition","Collection"],before:{eff:"35%",hc:"Moderate"},after:{eff:"72%+",hc:"Near Zero",harvest:"50 kg/1000 km"}},
                {id:904,name:"Butane Perfection",desc:"Portable fuel perfection",tool:"CVD FirstGen 3000 PECVD",process:["Load C₄H₁₀","Plasma","Proprietary alignment pulse (NDA)","Shell","Collect"],before:{eff:"34%"},after:{eff:"71%+",harvest:"48 kg/1000 km"}},
                {id:905,name:"Hexane Perfection",desc:"Solvent & fuel intermediate",tool:"CVD FirstGen 3000 PECVD",process:["Load C₆H₁₄","Plasma","Proprietary alignment pulse (NDA)","Shell","Collect"],before:{eff:"36%"},after:{eff:"73%+",harvest:"52 kg/1000 km"}},
                {id:906,name:"Diesel-Range Perfection",desc:"Heavy fuel ultra-efficiency",tool:"CVD FirstGen 3000 PECVD",process:["Load C₁₂–C₂₆ cut","Plasma","Proprietary alignment pulse (NDA)","Shell","Collect"],before:{eff:"42%",soot:"High"},after:{eff:"78%+",soot:"Zero",harvest:"65 kg/1000 km"}},
                {id:907,name:"Kerosene Perfection",desc:"Aviation-grade clean burn",tool:"CVD FirstGen 3000 PECVD",process:["Load C₁₀–C₁₆","Plasma","Proprietary alignment pulse (NDA)","Shell","Collect"],before:{eff:"40%"},after:{eff:"76%+",harvest:"60 kg/1000 km"}},
                {id:908,name:"Ethane Perfection",desc:"Natural gas component optimization",tool:"CVD FirstGen 3000 PECVD",process:["Load C₂H₆","Plasma","Proprietary alignment pulse (NDA)","Shell","Collect"],before:{eff:"33%"},after:{eff:"71%+",harvest:"42 kg/1000 km"}},
                {id:909,name:"Jet-A Perfection",desc:"Commercial aviation fuel upgrade",tool:"CVD FirstGen 3000 PECVD",process:["Load Jet-A spec","Plasma","Proprietary alignment pulse (NDA)","Shell","Collect"],before:{eff:"41%"},after:{eff:"77%+",harvest:"62 kg/1000 km"}},
                {id:910,name:"Gasoline Blend Perfection",desc:"Universal pump gasoline enhancement",tool:"CVD FirstGen 3000 PECVD",process:["Load mixed C5-C12 + ferrocene","Plasma","Proprietary alignment pulse (NDA)","Shell","Collect"],before:{eff:"38%"},after:{eff:"75%+",harvest:"55 kg/1000 km"}}
            ],
            metalglass: [
                {id:921,name:"Aluminum Perfection",desc:"Dross-free casting, ultra-fine grains",tool:"CVD FirstGen 3000 PECVD",process:["Load TMA vapor","Plasma ignition (700°C, 5 Torr)","Proprietary alignment pulse (NDA)","Carbon shell","Collection – drop into molten Al"],before:{strength:"240 MPa",inclusions:"High"},after:{strength:"450 MPa",inclusions:"Zero"}},
                {id:922,name:"Copper Perfection",desc:"Zero oxidation, maximum conductivity",tool:"CVD FirstGen 3000 PECVD",process:["Load copper acetylacetonate","Plasma","Proprietary alignment pulse (NDA)","Shell","Collect"],before:{cond:"98% IACS"},after:{cond:"102% IACS",ox:"Zero"}},
                {id:923,name:"Steel Perfection",desc:"Inclusion-free microstructure",tool:"CVD FirstGen 3000 PECVD",process:["Load ferrocene + carbonyl","Plasma","Proprietary alignment pulse (NDA)","Shell","Collect"],before:{strength:"350 MPa"},after:{strength:"650 MPa",inclusions:"Zero"}},
                {id:924,name:"Titanium Perfection",desc:"Aerospace-grade purity",tool:"CVD FirstGen 3000 PECVD",process:["Load TiCl₄","Plasma","Proprietary alignment pulse (NDA)","Shell","Collect"],before:{strength:"900 MPa"},after:{strength:"1300 MPa",ox:"Zero"}},
                {id:925,name:"Nickel Perfection",desc:"Superalloy refinement",tool:"CVD FirstGen 3000 PECVD",process:["Load nickel carbonyl","Plasma","Proprietary alignment pulse (NDA)","Shell","Collect"],before:{creep:"Moderate"},after:{creep:"Excellent",strength:"+40%"}},
                {id:926,name:"Soda-Lime Glass Perfection",desc:"Float glass bath additive",before:{hardness:"5.5 Mohs",tough:"0.7 MPa·m¹/²"},after:{hardness:"8.5 Mohs",tough:"2.1 MPa·m¹/²",bubbles:"Zero"},tool:"CVD FirstGen 3000 PECVD",process:["Load TEOS + Na ethoxide","Plasma","Proprietary alignment pulse (NDA)","Silica network perfection","Collection"]},
                {id:927,name:"Borosilicate Glass Perfection",desc:"Lab & cookware grade",before:{shock:"Moderate"},after:{shock:"Excellent",clarity:"Perfect"},tool:"CVD FirstGen 3000 PECVD",process:["Load TEOS + borane","Plasma","Proprietary alignment pulse (NDA)","Network","Collect"]},
                {id:928,name:"Quartz Glass Perfection",desc:"Optical & semiconductor purity",before:{purity:"99.9%"},after:{purity:"99.999%",inclusions:"Zero"},tool:"CVD FirstGen 3000 PECVD",process:["Load high-purity TEOS","Plasma","Proprietary alignment pulse (NDA)","Network","Collect"]},
                {id:929,name:"Low-E Glass Coating Powder",desc:"Architectural energy efficiency",before:{emissivity:"0.84"},after:{emissivity:"0.05",trans:"90%"},tool:"CVD FirstGen 3000 PECVD",process:["Load TEOS + tin octylate","Plasma","Proprietary alignment pulse (NDA)","Coating","Collect"]},
                {id:930,name:"Self-Cleaning Glass Powder",desc:"Photocatalytic hydrophobic surface",before:{contact:"60°"},after:{contact:"165°",clean:"Self-maintaining"},tool:"CVD FirstGen 3000 PECVD",process:["Load TEOS + titanium isopropoxide","Plasma","Proprietary alignment pulse (NDA)","TiO₂ doping","Collect"]}
            ],
            thermal: [
                {id:941,name:"Al₆₅Cu₂₃Fe₁₂ Quasicrystal",desc:"Classic icosahedral coating",before:{hard:"400 HV",fric:"0.6"},after:{hard:"950 HV",fric:"0.06"},tool:"MesoScribe MesoPlasma™ Printer",process:["Load Al-Cu-Fe powder hopper","Plasma arc ignition (35 kW)","Conformal spray (150 mm/s)","Proprietary cool-rate pulse (NDA)","Finish"]},
                {id:942,name:"Al-Cu-Fe-Cr-B Quasicrystal",desc:"Wear-resistant hybrid",before:{wear:"High"},after:{wear:"Ultra-low",hard:"1000 HV"},tool:"MesoScribe MesoPlasma™ Printer",process:["Load hybrid powder","Plasma arc","Spray","Proprietary cool-rate pulse (NDA)","Finish"]},
                {id:943,name:"Al-Co-Fe Quasicrystal",desc:"Magnetic low-friction",before:{fric:"0.5"},after:{fric:"0.08",mag:"Tunable"},tool:"MesoScribe MesoPlasma™ Printer",process:["Load Co-substituted powder","Plasma","Spray","Proprietary cool-rate pulse (NDA)","Finish"]},
                {id:944,name:"Ti-Zr-Ni Quasicrystal",desc:"Hydrogen storage capable",before:{storage:"1.5 wt%"},after:{storage:"4.2 wt%"},tool:"MesoScribe MesoPlasma™ Printer",process:["Load Ti-Zr-Ni powder","Plasma","Spray","Proprietary cool-rate pulse (NDA)","Finish"]},
                {id:945,name:"Al-Pd-Mn Quasicrystal",desc:"Ultra-low thermal conductivity",before:{k:"150 W/mK"},after:{k:"3 W/mK"},tool:"MesoScribe MesoPlasma™ Printer",process:["Load Pd-Mn alloy powder","Plasma","Spray","Proprietary cool-rate pulse (NDA)","Finish"]},
                {id:946,name:"Al-Li-Cu-Mg Quasicrystal",desc:"Lightweight aerospace",before:{dens:"2.7 g/cc"},after:{dens:"2.3 g/cc",strength:"+60%"},tool:"MesoScribe MesoPlasma™ Printer",process:["Load Li-add powder","Plasma","Spray","Proprietary cool-rate pulse (NDA)","Finish"]},
                {id:947,name:"Zr-Cu-Ni-Al BMG Hybrid",desc:"Amorphous-quasicrystal composite",before:{tough:"Moderate"},after:{tough:"Excellent"},tool:"MesoScribe MesoPlasma™ Printer",process:["Load amorphous precursor","Plasma","Spray","Proprietary cool-rate pulse (NDA)","Finish"]},
                {id:949,name:"Ti-Fe-Si Quasicrystal",desc:"Biomedical compatibility",before:{bio:"Standard"},after:{bio:"Superior"},tool:"MesoScribe MesoPlasma™ Printer",process:["Load biocompatible alloy","Plasma","Spray","Proprietary cool-rate pulse (NDA)","Finish"]},
                {id:950,name:"Decagonal Al-Ni-Co",desc:"Anisotropic properties",before:{fric:"0.4"},after:{fric:"0.05 directional"},tool:"MesoScribe MesoPlasma™ Printer",process:["Load anisotropic powder","Plasma","Directional spray","Proprietary cool-rate pulse (NDA)","Finish"]}
            ]
        };

        let currentCat = 'hydro';
        let scene, renderer, camera, controls, animationId;

        function init3D() {
            const container = document.getElementById('scene-container');
            if (!container) return;

            scene = new THREE.Scene();
            scene.background = new THREE.Color(var(--bg-color));

            camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 0, 5);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(5, 5, 5);
            scene.add(light);
            scene.add(new THREE.AmbientLight(0x404060));

            animate();
        }

        function animate() {
            animationId = requestAnimationFrame(animate);
            controls.update();
            if (scene.children.length > 2) scene.children[2].rotation.y += 0.005;
            renderer.render(scene, camera);
        }

        function createLattice(type, state) {
            // Cleanup previous
            while(scene.children.length > 2) {
                const child = scene.children[2];
                if (child.geometry) child.geometry.dispose();
                if (child.material) child.material.dispose();
                scene.remove(child);
            }

            let geometry;
            if (type === 'chain') {
                geometry = new THREE.BufferGeometry();
                const positions = [];
                for (let i = 0; i < 20; i++) {
                    positions.push(Math.sin(i*0.5)*0.5, i*0.3-3, Math.cos(i*0.5)*0.5);
                }
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
                const mat = new THREE.LineBasicMaterial({color: 0x00ffaa});
                scene.add(new THREE.Line(geometry, mat));
                // spheres for atoms
                for (let i = 0; i < positions.length; i+=3) {
                    const sphere = new THREE.Mesh(new THREE.SphereGeometry(0.15), new THREE.MeshStandardMaterial({color: i%9===0 ? 0xff4444 : 0x44aaff}));
                    sphere.position.set(positions[i], positions[i+1], positions[i+2]);
                    scene.add(sphere);
                }
            } else if (type === 'fcc') {
                const mat = new THREE.MeshStandardMaterial({color: 0xffaa00, metalness: 0.8});
                for (let x = -1; x <= 1; x+=1) for (let y = -1; y <= 1; y+=1) for (let z = -1; z <= 1; z+=1) {
                    const sphere = new THREE.Mesh(new THREE.SphereGeometry(0.3), mat);
                    sphere.position.set(x, y, z);
                    scene.add(sphere);
                }
            } else if (type === 'glass') {
                const mat = new THREE.MeshStandardMaterial({color: 0xaaddff, transparent: true, opacity: 0.7});
                for (let i = 0; i < 50; i++) {
                    const sphere = new THREE.Mesh(new THREE.SphereGeometry(0.2 + Math.random()*0.1), mat);
                    sphere.position.set(Math.random()*4-2, Math.random()*4-2, Math.random()*4-2);
                    scene.add(sphere);
                }
            } else { // quasicrystal icosahedral
                const mat = new THREE.MeshStandardMaterial({color: 0xff66ff, metalness: 0.9});
                const ico = new THREE.IcosahedronGeometry(2, 1);
                const mesh = new THREE.Mesh(ico, mat);
                scene.add(mesh);
            }
        }

        function buildGrid(cat) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            database[cat].forEach(rank => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<strong>${rank.id} – ${rank.name}</strong><br><small>${rank.desc}</small><span class="badge">Buildable Today</span>`;
                card.onclick = () => showDetail(rank, cat.includes('hydro') ? 'chain' : cat.includes('metal') ? (rank.id >=926 ? 'glass' : 'fcc') : 'ico');
                grid.appendChild(card);
            });
        }

        function showDetail(rank, vizType) {
            document.getElementById('detail-title').textContent = `${rank.id} – ${rank.name}`;
            document.getElementById('detail-desc').textContent = rank.desc;
            createLattice(vizType, 'before');
            let table = '<table><tr><th>Property</th><th>Conventional</th><th>Perfected System</th><th>Improvement</th></tr>';
            if (rank.before.eff) {
                table += `<tr><td>Thermal Efficiency</td><td>${rank.before.eff}</td><td>${rank.after.eff}</td><td>Substantial</td></tr>`;
                table += `<tr><td>Emissions (HC/CO/Soot)</td><td>${rank.before.hc || 'High'}</td><td>${rank.after.hc || 'Near Zero'}</td><td>—</td></tr>`;
                if (rank.after.harvest) table += `<tr><td>Graphite Harvest</td><td>0 kg</td><td>${rank.after.harvest}</td><td>Revenue Stream</td></tr>`;
            } else if (rank.before.hardness) {
                table += `<tr><td>Hardness</td><td>${rank.before.hardness}</td><td>${rank.after.hardness}</td><td>Significant</td></tr>`;
                table += `<tr><td>Toughness/Clarity</td><td>${rank.before.tough || 'Standard'}</td><td>${rank.after.tough || 'Perfect'}</td><td>—</td></tr>`;
            } else {
                Object.keys(rank.before).forEach(key => {
                    table += `<tr><td>${key.charAt(0).toUpperCase() + key.slice(1)}</td><td>${rank.before[key]}</td><td>${rank.after[key] || rank.after[key.replace('before.','')]}</td><td>Major</td></tr>`;
                });
            }
            table += '</table>';
            document.getElementById('detail-table').innerHTML = table;
            document.getElementById('detail').style.display = 'flex';
            if (!renderer) init3D();
            renderer.setSize(window.innerWidth/2, window.innerHeight);
        }

        document.querySelectorAll('.tab').forEach(tab => {
            tab.onclick = () => {
                document.querySelector('.tab.active').classList.remove('active');
                tab.classList.add('active');
                currentCat = tab.dataset.cat;
                buildGrid(currentCat);
            };
        });

        document.getElementById('close').onclick = () => {
            document.getElementById('detail').style.display = 'none';
        };

        window.onresize = () => {
            if (renderer) {
                camera.aspect = (window.innerWidth/2) / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth/2, window.innerHeight);
            }
        };

        init3D();
        buildGrid('hydro');
    </script>
</body>
</html>
